<!DOCTYPE HTML>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="轻松应对复杂业务逻辑：LiteFlow-编排式规则引擎框架的优势, Java，Spring，SpringBoot，SpringCloud，Elasticsearch，MQ，工作流，规则引擎">
    <meta name="baidu-site-verification" content="fmlEuI34ir">
    <meta name="google-site-verification" content="yCy2azpds5XSuGZvis6OuA-XIGF5GuGpYRAaGfD6o48">
    <meta name="360-site-verification" content="b7c11a830ef90fd1464ad6206bb7b6e7">
    <meta name="description" content="
关注公众号【码农Academy】，每日技术干货马上就来！



LiteFlow简介LiteFlow是什么？LiteFlow是一款专注于逻辑驱动流程编排的轻量级框架，它以组件化方式快速构建和执行业务流程，有效解耦复杂业务逻辑。通过支持热加">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>轻松应对复杂业务逻辑：LiteFlow-编排式规则引擎框架的优势 | 码农Academy的博客</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    <style type="text/css">
        
    </style>

    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?ce84511d3df71640a9378a69f6293044";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

    
        <script>
            (function(){
                var bp = document.createElement('script');
                var curProtocol = window.location.protocol.split(':')[0];
                if (curProtocol === 'https') {
                    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
                }
                else {
                    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                }
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(bp, s);
            })();
        </script>
    

    <script>
        (function(){
        var src = "https://jspassport.ssl.qhimg.com/11.0.1.js?d182b3f28525f2db83acfaaf6e696dba";
        document.write('<script src="' + src + '" id="sozz"><\/script>');
        })();
    </script>

<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body>

    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">码农Academy的博客</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>首页</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <i class="fa fa-tags"></i>
            
            <span>标签</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>分类</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>归档</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>关于</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/friends" class="waves-effect waves-light">
            
            <i class="fa fa-address-book"></i>
            
            <span>友情链接</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/contact" class="waves-effect waves-light">
            
            <i class="fa fa-comments"></i>
            
            <span>留言板</span>
        </a>
    </li>
    
    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="搜索"></i>
        </a>
    </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">码农Academy的博客</div>
        <div class="logo-desc">
            
            专注分享Java技术干货，包括Java基础、Spring Boot、Spring Cloud、Mysql、Redis、Elasticsearch、中间件、架构设计、面试题、程序员攻略等
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                首页
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-tags"></i>
                
                标签
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                分类
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                归档
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                关于
            </a>
        </li>
        
        <li>
            <a href="/friends" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-address-book"></i>
                
                友情链接
            </a>
        </li>
        
        <li>
            <a href="/contact" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-comments"></i>
                
                留言板
            </a>
        </li>
        
        
    </ul>
</div>

        </div>

        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/featureimages/38.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        轻松应对复杂业务逻辑：LiteFlow-编排式规则引擎框架的优势
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 20px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                        <a href="/tags/SpringBoot/" target="_blank">
                            <span class="chip bg-color">SpringBoot</span>
                        </a>
                        
                        <a href="/tags/LiteFlow/" target="_blank">
                            <span class="chip bg-color">LiteFlow</span>
                        </a>
                        
                        <a href="/tags/规则引擎/" target="_blank">
                            <span class="chip bg-color">规则引擎</span>
                        </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fa fa-bookmark fa-fw icon-category"></i>
                        
                        <a href="/categories/规则引擎/" class="post-category" target="_blank">
                            规则引擎
                        </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2024-02-01
                </div>

                <div class="post-author info-break-policy">
                    <i class="fa fa-user-o fa-fw"></i>作者:&nbsp;&nbsp;
                    
                    码农Academy
                    
                </div>

                
                
                <div class="info-break-policy">
                    <i class="fa fa-file-word-o fa-fw"></i>文章字数:&nbsp;&nbsp;
                    11.5k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="fa fa-clock-o fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    46 分
                </div>
                
                

                
                <div id="busuanzi_container_page_pv" class="info-break-policy">
                    <i class="fa fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                    <span id="busuanzi_value_page_pv"></span>
                </div>
                
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <blockquote>
<p>关注公众号【码农Academy】，每日技术干货马上就来！</p>
</blockquote>
<p><img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/medias/contact.jpg" alt="contact.jpg"></p>
<p><img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/blogcontent/LiteFlow.png" alt="LiteFlow.png"></p>
<h3 id="LiteFlow简介"><a href="#LiteFlow简介" class="headerlink" title="LiteFlow简介"></a>LiteFlow简介</h3><h4 id="LiteFlow是什么？"><a href="#LiteFlow是什么？" class="headerlink" title="LiteFlow是什么？"></a>LiteFlow是什么？</h4><p><code>LiteFlow</code>是一款专注于逻辑驱动流程编排的轻量级框架，它以组件化方式快速构建和执行业务流程，有效解耦复杂业务逻辑。通过支持热加载规则配置，开发者能够即时调整流程步骤，将复杂的业务如价格计算、下单流程等拆分为独立且可复用的组件，从而实现系统的高度灵活性与扩展性，避免了牵一发而动全身的问题。旨在优化开发流程，减少冗余工作，让团队能够更聚焦于核心业务逻辑，而将流程控制层面的重任托付给该框架进行自动化处理。</p>
<p><code>LiteFlow</code>整合了流程编排与规则引擎的核心特性，提供<code>XML</code>、<code>JSON</code>或<code>YAML</code>格式的灵活流程定义，以及本地文件系统、数据库、ZooKeeper、Nacos、Apollo、Redis等多种规则文件存储方案。其内建插件如liteflow-rule-nacos，以及开放的扩展机制，赋予开发人员自定义规则解析器的能力，满足多样化场景下的规则管理需求。</p>
<blockquote>
<p>对于基于角色任务流转的场景，<code>LiteFlow</code>并非最佳选择，推荐使用<code>Flowable</code>或<code>Activiti</code>等专门的工作流引擎。</p>
</blockquote>
<h4 id="LiteFlow的架构"><a href="#LiteFlow的架构" class="headerlink" title="LiteFlow的架构"></a>LiteFlow的架构</h4><p><code>LiteFlow</code>是从获取上下文开始的，这个上下文通常包含了执行流程所需的数据和环境信息。通过解析这些上下文数据，<code>LiteFlow</code>能够理解并执行对应的规则文件，驱动业务流程的执行。在<code>LiteFlow</code>中，业务流程被组织成一系列的链路（或节点），每个链路代表一个业务步骤或决策点。这些链路上的节点，也就是业务组件，是独立的，可以支持多种脚本语言，如<code>Groovy</code>、<code>JavaScript</code>、<code>Python</code>、<code>Lua</code>等，以便根据具体业务需求进行定制。下图为<code>LiteFlow</code>的整体架构图。</p>
<p><img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/blogcontent/LiteFlow%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B.png" alt="LiteFlow执行流程.png"></p>
<h4 id="LiteFlow的作用"><a href="#LiteFlow的作用" class="headerlink" title="LiteFlow的作用"></a>LiteFlow的作用</h4><ul>
<li><p><code>LiteFlow</code>将瀑布式代码进行组件化、灵活的编排体系，组件可独立调整替换，规则引擎语法简单易学。<br>利用<code>LiteFlow</code>可以把传统的瀑布式代码重构为以组件为中心的概念体系，从而获得灵活的编排能力。在这种结构里，各个组件彼此分离，允许轻松调整和替换。组件本身可通过脚本定制，而且组件间的过渡完全受规则引导。此外，<code>LiteFlow</code>具备简单易懂的<code>DSL</code>规则引擎语法，能快速入门掌握。<br><img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/blogcontent/20240123172903.png" alt="image.png"></p>
</li>
<li><p><code>LiteFlow</code>强大的编排能力<br><code>LiteFlow</code>的编排语法强大到可以编排出任何你想要的逻辑流程。如下图复杂的语法，如果使用瀑布式的代码去写，那种开发以及维护难度可想而知，但是使用<code>LiteFlow</code>你可以轻松完成逻辑流程的编排，易于维护。<br><img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/blogcontent/20240123173145.png" alt="image.png"></p>
</li>
<li><p><code>LiteFlow</code>支持组件热部署<br>通过<code>LiteFlow</code>，你可以实现组件的实时热替换，同时也能在已有的逻辑流程中随时插入新的组件，以此动态调整你的业务逻辑。<br><img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/blogcontent/20240123173357.png" alt="image.png"></p>
<h3 id="LiteFlow的环境支持"><a href="#LiteFlow的环境支持" class="headerlink" title="LiteFlow的环境支持"></a>LiteFlow的环境支持</h3></li>
<li><p>JDK<br><code>LiteFlow</code>要求的最低的JDK版本为8，支持<code>JDK8~JDK17</code>所有的版本。当然如果使用<code>JDK11</code>以上，确保<code>LiteFlow</code>的版本为<code>v2.10.6</code>及其以上版本。</p>
<blockquote>
<p>如果你使用JDK11及其以上的版本，请确保jvm参数加上以下参数:–add-opens java.base/sun.reflect.annotation=ALL-UNNAMED</p>
</blockquote>
</li>
<li><p>Spring<br><code>LiteFlow</code>要求的Spring的最低版本为<code>Spring 5.0</code>。支持的范围是<code>Spring 5.X ~ Spring 6.X</code>。</p>
</li>
<li><p>SpringBoot<br><code>LiteFlow</code>要求的Springboot的最低的版本是2.0。支持的范围是<code>Springboot 2.X ~ Springboot 3.X</code>。</p>
</li>
</ul>
<h3 id="LiteFlow的性能"><a href="#LiteFlow的性能" class="headerlink" title="LiteFlow的性能"></a>LiteFlow的性能</h3><p><code>LiteFlow</code>框架在启动时完成大部分工作，包括解析规则、注册组件和组装元信息，执行链路时对系统资源消耗极低。在设计之初就注重性能表现，对核心代码进行了优化。</p>
<p>实际测试中，<code>LiteFlow</code>表现出色，50多个业务组件组成的链路在压测中单点达到1500 TPS，成功应对双11、明星顶流带货等大规模流量挑战。</p>
<p>尽管<code>LiteFlow</code>框架自身性能卓越，但实际执行效率取决于业务组件的性能。若组件包含大量循环数据库查询、不良<code>SQL</code> 或大量<code>RPC</code>同步调用，整体<code>TPS</code>也会较低。但这归咎于业务组件的性能问题，而非<code>LiteFlow</code>框架本身的性能问题。整体系统吞吐量的高低不只依赖于某个框架，而是需要整体优化业务代码才能提升。</p>
<blockquote>
<p>数据来源于LiteFlow官方文档说明。</p>
</blockquote>
<h3 id="LiteFlow使用"><a href="#LiteFlow使用" class="headerlink" title="LiteFlow使用"></a>LiteFlow使用</h3><p>以下我们结合SpringBoot环境使用。</p>
<p><code>LiteFlow</code>在使用上可以按照引入依赖，<code>LiteFlow</code>相关配置，规则文件，定义组件，节点编排，执行流程进行。</p>
<h4 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h4><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.yomahub<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>liteflow-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.11.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>目前liteflow的稳定版本已经更新到2.11.4.2。本文依托于2.11.1做讲解演示。好多新的功能均在2.9.0以后的版本中才有。</p>
</blockquote>
<h4 id="配置项"><a href="#配置项" class="headerlink" title="配置项"></a>配置项</h4><p><code>LiteFlow</code>有诸多配置项，大多数配置项有默认值，可以不必配置，同时官方也建议某个配置项不了解它有什么用时，就不要去随意的改它的值。</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">liteflow</span><span class="token punctuation">:</span>
  <span class="token comment" spellcheck="true">#规则文件路径</span>
  <span class="token key atrule">rule-source</span><span class="token punctuation">:</span> config/flow.el.xml
  <span class="token comment" spellcheck="true">#-----------------以下非必须-----------------</span>
  <span class="token comment" spellcheck="true">#liteflow是否开启，默认为true</span>
  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment" spellcheck="true">#liteflow的banner打印是否开启，默认为true</span>
  <span class="token key atrule">print-banner</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment" spellcheck="true">#zkNode的节点，只有使用zk作为配置源的时候才起作用，默认为/lite-flow/flow</span>
  <span class="token key atrule">zk-node</span><span class="token punctuation">:</span> /lite<span class="token punctuation">-</span>flow/flow
  <span class="token comment" spellcheck="true">#上下文的最大数量槽，默认值为1024</span>
  <span class="token key atrule">slot-size</span><span class="token punctuation">:</span> <span class="token number">1024</span>
  <span class="token comment" spellcheck="true">#FlowExecutor的execute2Future的线程数，默认为64</span>
  <span class="token key atrule">main-executor-works</span><span class="token punctuation">:</span> <span class="token number">64</span>
  <span class="token comment" spellcheck="true">#FlowExecutor的execute2Future的自定义线程池Builder，LiteFlow提供了默认的Builder</span>
  <span class="token key atrule">main-executor-class</span><span class="token punctuation">:</span> com.yomahub.liteflow.thread.LiteFlowDefaultMainExecutorBuilder
  <span class="token comment" spellcheck="true">#自定义请求ID的生成类，LiteFlow提供了默认的生成类</span>
  <span class="token key atrule">request-id-generator-class</span><span class="token punctuation">:</span> com.yomahub.liteflow.flow.id.DefaultRequestIdGenerator
  <span class="token comment" spellcheck="true">#并行节点的线程池Builder，LiteFlow提供了默认的Builder</span>
  <span class="token key atrule">thread-executor-class</span><span class="token punctuation">:</span> com.yomahub.liteflow.thread.LiteFlowDefaultWhenExecutorBuilder
  <span class="token comment" spellcheck="true">#异步线程最长的等待时间(只用于when)，默认值为15000</span>
  <span class="token key atrule">when-max-wait-time</span><span class="token punctuation">:</span> <span class="token number">15000</span>
  <span class="token comment" spellcheck="true">#异步线程最长的等待时间(只用于when)，默认值为MILLISECONDS，毫秒</span>
  <span class="token key atrule">when-max-wait-time-unit</span><span class="token punctuation">:</span> MILLISECONDS
  <span class="token comment" spellcheck="true">#when节点全局异步线程池最大线程数，默认为16</span>
  <span class="token key atrule">when-max-workers</span><span class="token punctuation">:</span> <span class="token number">16</span>
  <span class="token comment" spellcheck="true">#并行循环子项线程池最大线程数，默认为16</span>
  <span class="token key atrule">parallelLoop-max-workers</span><span class="token punctuation">:</span> <span class="token number">16</span>
  <span class="token comment" spellcheck="true">#并行循环子项线程池等待队列数，默认为512</span>
  <span class="token key atrule">parallelLoop-queue-limit</span><span class="token punctuation">:</span> <span class="token number">512</span>
  <span class="token comment" spellcheck="true">#并行循环子项的线程池Builder，LiteFlow提供了默认的Builder</span>
  <span class="token key atrule">parallelLoop-executor-class</span><span class="token punctuation">:</span> com.yomahub.liteflow.thread.LiteFlowDefaultParallelLoopExecutorBuilder
  <span class="token comment" spellcheck="true">#when节点全局异步线程池等待队列数，默认为512</span>
  <span class="token key atrule">when-queue-limit</span><span class="token punctuation">:</span> <span class="token number">512</span>
  <span class="token comment" spellcheck="true">#是否在启动的时候就解析规则，默认为true</span>
  <span class="token key atrule">parse-on-start</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment" spellcheck="true">#全局重试次数，默认为0</span>
  <span class="token key atrule">retry-count</span><span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token comment" spellcheck="true">#是否支持不同类型的加载方式混用，默认为false</span>
  <span class="token key atrule">support-multiple-type</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token comment" spellcheck="true">#全局默认节点执行器</span>
  <span class="token key atrule">node-executor-class</span><span class="token punctuation">:</span> com.yomahub.liteflow.flow.executor.DefaultNodeExecutor
  <span class="token comment" spellcheck="true">#是否打印执行中过程中的日志，默认为true</span>
  <span class="token key atrule">print-execution-log</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment" spellcheck="true">#是否开启本地文件监听，默认为false</span>
  <span class="token key atrule">enable-monitor-file</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token comment" spellcheck="true">#是否开启快速解析模式，默认为false</span>
  <span class="token key atrule">fast-load</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token comment" spellcheck="true">#简易监控配置选项</span>
  <span class="token key atrule">monitor</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#监控是否开启，默认不开启</span>
    <span class="token key atrule">enable-log</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token comment" spellcheck="true">#监控队列存储大小，默认值为200</span>
    <span class="token key atrule">queue-limit</span><span class="token punctuation">:</span> <span class="token number">200</span>
    <span class="token comment" spellcheck="true">#监控一开始延迟多少执行，默认值为300000毫秒，也就是5分钟</span>
    <span class="token key atrule">delay</span><span class="token punctuation">:</span> <span class="token number">300000</span>
    <span class="token comment" spellcheck="true">#监控日志打印每过多少时间执行一次，默认值为300000毫秒，也就是5分钟</span>
    <span class="token key atrule">period</span><span class="token punctuation">:</span> <span class="token number">300000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>只要使用规则，则必须配置<code>rule-source</code>配置，但是如果你是用代码动态构建规则，则<code>rule-source</code>自动失效。</p>
</blockquote>
<h4 id="规则文件"><a href="#规则文件" class="headerlink" title="规则文件"></a>规则文件</h4><p>从上面<code>LiteFlow</code>的整体架构图中可以看出<code>LiteFlow</code>支持多种规则文件源配置：本地文件，数据库，zk，Nacos，Apollo，Etcd，Redis以及自定义配置源。本文将会以本地规则文件为例讲解，其余配置源将在后续文章中讲解实时修改流程中在进行分享，</p>
<p><code>LiteFlow</code>支持3种规则文件格式：<code>XML</code>,<code>JSON</code>,<code>YML</code>，3种文件的配置相差无几。<code>LiteFlow</code>的组成很轻量，主要由<code>Node</code>以及<code>Chain</code>元素构成。值得一提的是：如果在非Spring环境下，<code>Node</code>节点是必须的，配置配置，否则会导致报错找不到节点。当然在Spring环境下，我们可以不必配置<code>Node</code>节点，只需要将相应的节点注册到Spring上下文即可。</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span>  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flow</span><span class="token punctuation">></span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>chain1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  
        THEN(a, b, c);  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span>  

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>scChain<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  
        SWITCH(s1).to(s2, THEN(a,b).id("d"));  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>flow</span><span class="token punctuation">></span></span>    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h4><p>在介绍具体的组件之前，我们先来了解下<code>@LiteflowComponent</code>注解。</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span> ElementType<span class="token punctuation">.</span>TYPE <span class="token punctuation">}</span><span class="token punctuation">)</span>  
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>RetentionPolicy<span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>  
<span class="token annotation punctuation">@Documented</span>  
<span class="token annotation punctuation">@Inherited</span>  
<span class="token annotation punctuation">@Component</span>  
<span class="token keyword">public</span> @<span class="token keyword">interface</span> <span class="token class-name">LiteflowComponent</span> <span class="token punctuation">{</span>  
    <span class="token annotation punctuation">@AliasFor</span><span class="token punctuation">(</span>annotation <span class="token operator">=</span> Component<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> attribute <span class="token operator">=</span> <span class="token string">"value"</span><span class="token punctuation">)</span>  
    String <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">""</span><span class="token punctuation">;</span>  
    <span class="token annotation punctuation">@AliasFor</span><span class="token punctuation">(</span>annotation <span class="token operator">=</span> Component<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> attribute <span class="token operator">=</span> <span class="token string">"value"</span><span class="token punctuation">)</span>  
    String <span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">""</span><span class="token punctuation">;</span> 
    <span class="token comment" spellcheck="true">/**
    * 可以给节点起别名
    **/</span>
    String <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">""</span><span class="token punctuation">;</span>  

<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>@LiteflowComponent</code>继承自<code>@Component</code>注解，在Spring环境中，可以将组件注入到容器中。它的value或者id即对应规则文件中的node的id。例如上述规则文件中的a,b,c等。</p>
<h5 id="普通组件：NodeComponent"><a href="#普通组件：NodeComponent" class="headerlink" title="普通组件：NodeComponent"></a>普通组件：NodeComponent</h5><p>普通组件节点需要继承<code>NodeComponent</code>，需要实现<code>process</code>方法。可用于<code>THEN</code>和<code>WHEN</code>编排中。</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@LiteflowComponent</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AComponent</span> <span class="token keyword">extends</span> <span class="token class-name">NodeComponent</span> <span class="token punctuation">{</span>  

    <span class="token annotation punctuation">@Override</span>  
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>  
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"执行A规则"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>当然<code>NodeComponent</code>中还有一些其他方法可以重写，以达到自己的业务需求。例如：</p>
<ul>
<li>isAccess()：表示是否进入该节点，可以用于业务参数的预先判断。</li>
<li>isContinueOnError()：表示出错是否继续往下执行下一个组件，默认为false</li>
<li>isEnd()：是否结束整个流程(不往下继续执行)。<br>如果返回true，则表示在这个组件执行完之后立马终止整个流程。此时由于是用户主动结束的流程，属于正常结束，所以流程结果中(<code>LiteflowResponse</code>)的isSuccess是true。</li>
<li>beforeProcess()和afterProcess()：流程的前置和后置处理器，其中前置处理器，在<code>isAccess</code> 之后执行。</li>
<li>onSuccess()和onError()：流程的成功失败事件回调</li>
<li>rollback()：流程失败后的回滚方法。</li>
</ul>
<p><strong>在任意组件节点的内部，还可以使用<code>this</code>关键字调用对应的方法：</strong></p>
<ul>
<li><p>获取流程初始入参参数<br>我们在组件节点内部可以通过<code>this.getRequestData()</code>去获取流程初始的入参。例如：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@LiteflowComponent</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AComponent</span> <span class="token keyword">extends</span> <span class="token class-name">NodeComponent</span> <span class="token punctuation">{</span>  

  <span class="token annotation punctuation">@Override</span>  
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>  
  DataRequest dataRequest <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRequestData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"执行A规则"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>获取上下文<br>在组件节点里，随时可以通过方法<code>this.getContextBean(clazz)</code>获取当前你自己定义的上下文，从而可以获取到上下文的数据。例如：</p>
</li>
</ul>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@LiteflowComponent</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AComponent</span> <span class="token keyword">extends</span> <span class="token class-name">NodeComponent</span> <span class="token punctuation">{</span>  

    <span class="token annotation punctuation">@Override</span>  
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>  
        ConditionContext context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getContextBean</span><span class="token punctuation">(</span>ConditionContext<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"执行A规则"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>setIsEnd<br>是否立即结束整个流程 ，用法为<code>this.setIsEnd(true)</code>。<br>还有一些其他的方法，可以参考源码。</li>
</ul>
<h5 id="选择组件：NodeSwitchComponent"><a href="#选择组件：NodeSwitchComponent" class="headerlink" title="选择组件：NodeSwitchComponent"></a>选择组件：NodeSwitchComponent</h5><p>实际业务中，我们针对不同的业务类型，有不同的业务处理逻辑，例如上一篇文章中的订单类型一样，此时就需要节点动态的判断去执行哪些节点或者链路，所以就出现了选择组件。<br>选择组件需要实现<code>NodeSwitchComponent</code>，并且需要实现<code>processSwitch()</code>方法。用于<code>SWITCH</code>编排中。</p>
<p><code>processSwitch()</code>方法返回值是一个String，即下一步流程执行的节点ID或者链路tag。</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@LiteflowComponent</span><span class="token punctuation">(</span>"s<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SwitchComponent</span> <span class="token keyword">extends</span> <span class="token class-name">NodeSwitchComponent</span> <span class="token punctuation">{</span>  

    <span class="token annotation punctuation">@Override</span>  
    <span class="token keyword">public</span> String <span class="token function">processSwitch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>  
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"执行switch规则"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">return</span> <span class="token string">"a"</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>规则文件中，配置的<code>SWITCH</code>编排信息为：</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>scChain<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  
    SWITCH(s).to(a, b, c);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>此时s节点就会返回要执行的节点id为a，即要执行a流程。通常switch的节点的逻辑我们需要具体结合业务类型，例如订单类型枚举去使用。</p>
<p>除了可以返回id以外，我们还可以返回tag(标签)。例如我们在规则文件中这么写:<br>在规则表达式中我们可以这样使用:</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>scChain<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  
    SWITCH(s).to(a.tag("td"), b.tag("td"), c.tag("td));  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>然后在<code>SWITCH</code>中返回tag：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@LiteflowComponent</span><span class="token punctuation">(</span>"s<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SwitchComponent</span> <span class="token keyword">extends</span> <span class="token class-name">NodeSwitchComponent</span> <span class="token punctuation">{</span>  

    <span class="token annotation punctuation">@Override</span>  
    <span class="token keyword">public</span> String <span class="token function">processSwitch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>  
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"执行switch规则"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">return</span> <span class="token string">":td"</span>      <span class="token comment" spellcheck="true">// 进入 b 节点，含义：选择第一个标签为td的节点</span>
        <span class="token keyword">return</span> <span class="token string">"tag:td"</span>   <span class="token comment" spellcheck="true">// 进入 b 节点，含义：选择第一个标签为td的节点</span>
        <span class="token keyword">return</span> <span class="token string">"a"</span><span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">// 进入 b 节点，含义：选择targetId是b的节点</span>
        <span class="token keyword">return</span> <span class="token string">"b:"</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// 进入 b 节点，含义：选择第一个targetId是b的节点</span>
        <span class="token keyword">return</span> <span class="token string">"b:td"</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 进入 b 节点，含义：选择targetId是b且标签是td的节点</span>
        <span class="token keyword">return</span> <span class="token string">":"</span><span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">// 进入 b 节点，含义：选择第一个节点</span>
        <span class="token keyword">return</span> <span class="token string">"d"</span><span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">// 进入 d 节点，含义：选择targetId是d的节点</span>
        <span class="token keyword">return</span> <span class="token string">"d:"</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// 进入 d 节点，含义：选择第一个targetId是d的节点</span>
        <span class="token keyword">return</span> <span class="token string">"d:td"</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 进入 d 节点，含义：选择targetId是d且标签是td的节点</span>
        <span class="token keyword">return</span> <span class="token string">"b:x"</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// 报错，原因：没有targetId是b且标签是x的节点</span>
        <span class="token keyword">return</span> <span class="token string">"x"</span><span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">// 报错，原因：没有targetId是x的节点</span>
        <span class="token keyword">return</span> <span class="token string">"::"</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// 报错，原因：没有找到标签是":"的节点 </span>
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>NodeSwitchComponent</code>继承至<code>NodeComponent</code>，其节点的内部可以覆盖的方法和this关键字<code>NodeComponent</code>。</p>
<h5 id="条件组件：NodeForComponent"><a href="#条件组件：NodeForComponent" class="headerlink" title="条件组件：NodeForComponent"></a>条件组件：NodeForComponent</h5><p>条件组件，也是IF组件，返回值是一个<code>boolean</code>。需要继承<code>NodeForComponent</code>，实现<code>processIf()</code>方法。可用于<code>IF...ELIF...ELSE</code>编排。例如：</p>
<pre class="line-numbers language-xml"><code class="language-xml">&lt;chain name = "ifChain">  
    IF(x, a, b);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>该例中x就是一个条件组件，如果x返回true，则会执行a节点，否则执行b节点。</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@LiteflowComponent</span><span class="token punctuation">(</span><span class="token string">"x"</span><span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IfXComponent</span> <span class="token keyword">extends</span> <span class="token class-name">NodeIfComponent</span> <span class="token punctuation">{</span>  

    <span class="token annotation punctuation">@Override</span>  
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">processIf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>  
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"执行X节点"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>NodeIfComponent</code>继承至<code>NodeComponent</code>，其节点内部可以覆盖的方法和this关键字<code>NodeComponent</code>。</p>
<h5 id="次数循环组件：NodeForComponent"><a href="#次数循环组件：NodeForComponent" class="headerlink" title="次数循环组件：NodeForComponent"></a>次数循环组件：NodeForComponent</h5><p>次数循环组件。返回的是一个int值的循环次数。继承<code>NodeForComponent</code>，实现<code>processFor()</code>方法, 主要用于<code>FOR...DO...</code>表达式。在紧接着DO编排中的节点中，可以通过<code>this.getLoopIndex()</code>获取下标信息，可以从对应数组或者集合中通过下表获取对应的元素信息。</p>
<pre class="line-numbers language-xml"><code class="language-xml">&lt;chain name = "forChain">  
    FOR(f).DO(a);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@LiteflowComponent</span><span class="token punctuation">(</span><span class="token string">"f"</span><span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ForComponent</span> <span class="token keyword">extends</span> <span class="token class-name">NodeForComponent</span> <span class="token punctuation">{</span>  

    <span class="token annotation punctuation">@Override</span>  
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">processFor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>  
        DataContext dataContext <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getContextBean</span><span class="token punctuation">(</span>DataContext<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        List<span class="token operator">&lt;</span>String<span class="token operator">></span> dataList <span class="token operator">=</span> dataContext<span class="token punctuation">.</span><span class="token function">getDataList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">return</span> dataList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@LiteflowComponent</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AComponent</span> <span class="token keyword">extends</span> <span class="token class-name">NodeComponent</span> <span class="token punctuation">{</span>  

    <span class="token annotation punctuation">@Override</span>  
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>  
        Integer loopIndex <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getLoopIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        DataContext dataContext <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getContextBean</span><span class="token punctuation">(</span>DataContext<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        List<span class="token operator">&lt;</span>String<span class="token operator">></span> dataList <span class="token operator">=</span> dataContext<span class="token punctuation">.</span><span class="token function">getDataList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        String str <span class="token operator">=</span> dataList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>loopIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"执行A规则:"</span><span class="token operator">+</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>其中f组件相当于定义一个数组或者集合的元素个数，类似</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>size<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// size = f </span>
<span class="token comment" spellcheck="true">//逻辑处理  = a</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><code>NodeForComponent</code>继承至<code>NodeComponent</code>，其节点内部可以覆盖的方法和this关键字<code>NodeComponent</code>。</p>
<h5 id="条件循环组件：NodeWhileComponent"><a href="#条件循环组件：NodeWhileComponent" class="headerlink" title="条件循环组件：NodeWhileComponent"></a>条件循环组件：NodeWhileComponent</h5><p>条件循环组件，主要用于<code>WHILE...DO...</code>表达式。继承<code>NodeWhileComponent</code>，需要实现<code>processWhile()</code>方法。<code>processWhile()</code>方法返回一个boolean类型的值，即while循环跳出的条件，如果为false则循环结束，同次数循环，可以在DO编排中的节点中，可以通过<code>this.getLoopIndex()</code>获取下标信息，可以从对应数组或者集合中通过下表获取对应的元素信息。</p>
<pre class="line-numbers language-xml"><code class="language-xml">&lt;chain name = "whileChain">  
    WHILE(w).DO(a);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@LiteflowComponent</span><span class="token punctuation">(</span><span class="token string">"w"</span><span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WhileComponent</span> <span class="token keyword">extends</span> <span class="token class-name">NodeWhileComponent</span> <span class="token punctuation">{</span>  

    <span class="token annotation punctuation">@Override</span>  
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">processWhile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>  
        DataContext dataContext <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getContextBean</span><span class="token punctuation">(</span>DataContext<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        Integer count <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>dataContext<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        List<span class="token operator">&lt;</span>String<span class="token operator">></span> dataList <span class="token operator">=</span> dataContext<span class="token punctuation">.</span><span class="token function">getDataList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">return</span> count <span class="token operator">&lt;</span> dataList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>NodeWhileComponent</code>继承至<code>NodeComponent</code>，其节点内部可以覆盖的方法和this关键字<code>NodeComponent</code>。</p>
<h5 id="迭代循环组件：NodeIteratorComponent"><a href="#迭代循环组件：NodeIteratorComponent" class="headerlink" title="迭代循环组件：NodeIteratorComponent"></a>迭代循环组件：NodeIteratorComponent</h5><p>迭代循环组件，相当于Java语言的<code>Iterator</code>关键字，功能上相当于<code>for</code>循环，主要用于<code>ITERATOR...DO...</code>表达式。需要继承<code>NodeIteratorComponent</code>，实现<code>processIterator()</code>方法。在DO编排的节点中，可以通过<code>this.getCurrLoopObj()</code>获取集合中的信息。这个组件在使用liteflow的循环组件时用的比较多，就像日常开发代码，集合遍历大部分都会使用for循环(特殊情况必须使用下标除外)。</p>
<pre class="line-numbers language-xml"><code class="language-xml">&lt;chain name = "iteratorChain">  
    ITERATOR(iterator).DO(a);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@LiteflowComponent</span><span class="token punctuation">(</span><span class="token string">"iterator"</span><span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyIteratorComponent</span> <span class="token keyword">extends</span> <span class="token class-name">NodeIteratorComponent</span> <span class="token punctuation">{</span>  

    <span class="token annotation punctuation">@Override</span>  
    <span class="token keyword">public</span> Iterator<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> <span class="token function">processIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>  
        DataContext dataContext <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getContextBean</span><span class="token punctuation">(</span>DataContext<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token keyword">return</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>dataContext<span class="token punctuation">.</span><span class="token function">getDataList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span>Lists<span class="token punctuation">.</span><span class="token function">newArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@LiteflowComponent</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AComponent</span> <span class="token keyword">extends</span> <span class="token class-name">NodeComponent</span> <span class="token punctuation">{</span>  

    <span class="token annotation punctuation">@Override</span>  
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>  
        String str <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getCurrLoopObj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"执行A规则:"</span><span class="token operator">+</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>NodeIteratorComponent</code>继承至<code>NodeComponent</code>，循环组件节点的内部可以覆盖的方法和this关键字<code>NodeComponent</code>。</p>
<h5 id="退出循环组件：NodeBreakComponent"><a href="#退出循环组件：NodeBreakComponent" class="headerlink" title="退出循环组件：NodeBreakComponent"></a>退出循环组件：NodeBreakComponent</h5><p>退出循环组件，即<code>BREAK</code>组件。返回的是一个布尔值的循环退出标志。 需要继承<code>NodeBreakComponent</code>，实现<code>processBreak</code>方法。主要用于<code>FOR...DO...BREAK</code>,<code>WHILE...DO...BREAK</code>,<code>ITERATOR...DO...BREAK</code>表达式。即Java的<code>for</code>，<code>while</code>循环退出。</p>
<pre class="line-numbers language-xml"><code class="language-xml">&lt;chain name = "iteratorChain">  
    ITERATOR(iterator).DO(a).BREAK(break_flag);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@LiteflowComponent</span><span class="token punctuation">(</span><span class="token string">"break_flag"</span><span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BreakComponent</span> <span class="token keyword">extends</span> <span class="token class-name">NodeBreakComponent</span> <span class="token punctuation">{</span>  

    <span class="token annotation punctuation">@Override</span>  
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">processBreak</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>  
        String str <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getCurrLoopObj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">return</span> Objects<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>同理<code>NodeBreakComponent</code>也是继承<code>NodeComponent</code>，其节点内部可以覆盖的方法和this关键字<code>NodeComponent</code>。</p>
<p>接下来我们聊一下组件的另外一种定义方式：声明式组件。我比较喜欢用。。。</p>
<h4 id="声明式组件"><a href="#声明式组件" class="headerlink" title="声明式组件"></a>声明式组件</h4><p>在上述介绍组件时，都是通过定义一个类继承某一个组件，例如<code>NodeComponent</code>或者<code>NodeIteratorComponent</code>，这样的定义组件会有一些弊端，比如当你的业务庞大时类也会快速的膨胀增加，即使一个跳出循环或者循环组件都要单独去定义一个类（个人认为循环组件其实不会包含太多的复杂业务逻辑），再比如说Java中类是单继承，这样就会造成这个写组件类无法再去继承一些其他的超类供我们使用。基于此，<code>LiteFlow</code>推出依靠注解完成组件的声明，即使一个普通类中的方法不需要继承任何组件类，也可以声明为一个组件，一个类可以定义很多个组件。可以分别对类或者方法进行生命组件。目前声明式组件只能在springboot环境中使用。</p>
<h5 id="类级别声明"><a href="#类级别声明" class="headerlink" title="类级别声明"></a>类级别声明</h5><p>类级别式声明主要用处就是通过注解形式让普通的java bean变成LiteFlow的组件。无需通过继承类或者实现接口的方式。但是类级别声明有一个缺点就是他和常规组件一样，需要一个类对应一个组件。使用<code>@LiteflowCmpDefine</code>注解，通过<code>NodeTypeEnum</code>指定当前类是什么类型的组件。<code>NodeTypeEnum</code>值如下：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">enum</span> NodeTypeEnum <span class="token punctuation">{</span>  
    <span class="token function">COMMON</span><span class="token punctuation">(</span><span class="token string">"common"</span><span class="token punctuation">,</span> <span class="token string">"普通"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> NodeComponent<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
    <span class="token function">SWITCH</span><span class="token punctuation">(</span><span class="token string">"switch"</span><span class="token punctuation">,</span> <span class="token string">"选择"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> NodeSwitchComponent<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
    <span class="token function">IF</span><span class="token punctuation">(</span><span class="token string">"if"</span><span class="token punctuation">,</span> <span class="token string">"条件"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> NodeIfComponent<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
    <span class="token function">FOR</span><span class="token punctuation">(</span><span class="token string">"for"</span><span class="token punctuation">,</span> <span class="token string">"循环次数"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> NodeForComponent<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
    <span class="token function">WHILE</span><span class="token punctuation">(</span><span class="token string">"while"</span><span class="token punctuation">,</span> <span class="token string">"循环条件"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> NodeWhileComponent<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
    <span class="token function">BREAK</span><span class="token punctuation">(</span><span class="token string">"break"</span><span class="token punctuation">,</span> <span class="token string">"循环跳出"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> NodeBreakComponent<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
    <span class="token function">ITERATOR</span><span class="token punctuation">(</span><span class="token string">"iterator"</span><span class="token punctuation">,</span> <span class="token string">"循环迭代"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> NodeIteratorComponent<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
    <span class="token function">SCRIPT</span><span class="token punctuation">(</span><span class="token string">"script"</span><span class="token punctuation">,</span> <span class="token string">"脚本"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> ScriptCommonComponent<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
    <span class="token function">SWITCH_SCRIPT</span><span class="token punctuation">(</span><span class="token string">"switch_script"</span><span class="token punctuation">,</span> <span class="token string">"选择脚本"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> ScriptSwitchComponent<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
    <span class="token function">IF_SCRIPT</span><span class="token punctuation">(</span><span class="token string">"if_script"</span><span class="token punctuation">,</span> <span class="token string">"条件脚本"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> ScriptIfComponent<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
    <span class="token function">FOR_SCRIPT</span><span class="token punctuation">(</span><span class="token string">"for_script"</span><span class="token punctuation">,</span> <span class="token string">"循环次数脚本"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> ScriptForComponent<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
    <span class="token function">WHILE_SCRIPT</span><span class="token punctuation">(</span><span class="token string">"while_script"</span><span class="token punctuation">,</span> <span class="token string">"循环条件脚本"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> ScriptWhileComponent<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
    <span class="token function">BREAK_SCRIPT</span><span class="token punctuation">(</span><span class="token string">"break_script"</span><span class="token punctuation">,</span> <span class="token string">"循环跳出脚本"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> ScriptBreakComponent<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>组件类中的再通过<code>@LiteflowMethod</code>注解将方法映射为组件方法。通过<code>@LiteflowMethod</code>中<code>value</code>值指定方法类型<code>LiteFlowMethodEnum</code>，通过<code>nodeType</code>指定节点类型<code>NodeTypeEnum</code>。<code>LiteFlowMethodEnum</code>对应各组件中的抽象类方法（<code>isMainMethod=true</code>）（或者可覆盖的方法）。</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">enum</span> LiteFlowMethodEnum <span class="token punctuation">{</span>  

    <span class="token function">PROCESS</span><span class="token punctuation">(</span><span class="token string">"process"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
    <span class="token function">PROCESS_SWITCH</span><span class="token punctuation">(</span><span class="token string">"processSwitch"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
    <span class="token function">PROCESS_IF</span><span class="token punctuation">(</span><span class="token string">"processIf"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
    <span class="token function">PROCESS_FOR</span><span class="token punctuation">(</span><span class="token string">"processFor"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
    <span class="token function">PROCESS_WHILE</span><span class="token punctuation">(</span><span class="token string">"processWhile"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
    <span class="token function">PROCESS_BREAK</span><span class="token punctuation">(</span><span class="token string">"processBreak"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
    <span class="token function">PROCESS_ITERATOR</span><span class="token punctuation">(</span><span class="token string">"processIterator"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
    <span class="token function">IS_ACCESS</span><span class="token punctuation">(</span><span class="token string">"isAccess"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
    <span class="token function">IS_END</span><span class="token punctuation">(</span><span class="token string">"isEnd"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
    <span class="token function">IS_CONTINUE_ON_ERROR</span><span class="token punctuation">(</span><span class="token string">"isContinueOnError"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
    <span class="token function">GET_NODE_EXECUTOR_CLASS</span><span class="token punctuation">(</span><span class="token string">"getNodeExecutorClass"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
    <span class="token function">ON_SUCCESS</span><span class="token punctuation">(</span><span class="token string">"onSuccess"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
    <span class="token function">ON_ERROR</span><span class="token punctuation">(</span><span class="token string">"onError"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
    <span class="token function">BEFORE_PROCESS</span><span class="token punctuation">(</span><span class="token string">"beforeProcess"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
    <span class="token function">AFTER_PROCESS</span><span class="token punctuation">(</span><span class="token string">"afterProcess"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
    <span class="token function">GET_DISPLAY_NAME</span><span class="token punctuation">(</span><span class="token string">"getDisplayName"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    <span class="token function">ROLLBACK</span><span class="token punctuation">(</span><span class="token string">"rollback"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>  
    <span class="token punctuation">;</span>

    <span class="token keyword">private</span> String methodName<span class="token punctuation">;</span>  
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> isMainMethod<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>对于方法的要求：</strong><br>组件内的方法的参数必须传入<code>NodeComponent</code>类型的参数，而且必须是第一个参数。这个参数值就替代常规组件中的<code>this</code>，从这个参数中可以获取流程入参，上线文等信息。然后方法的返回值必须跟常规组件中的抽象方法的返回值保持一致，否则可能吹出现错误。对于方法名称并无限制。</p>
<ul>
<li>普通组件：</li>
</ul>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">"d"</span><span class="token punctuation">)</span>  
<span class="token annotation punctuation">@LiteflowCmpDefine</span><span class="token punctuation">(</span>value <span class="token operator">=</span> NodeTypeEnum<span class="token punctuation">.</span>COMMON<span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyDefineCmp</span> <span class="token punctuation">{</span>  

    <span class="token annotation punctuation">@LiteflowMethod</span><span class="token punctuation">(</span>value <span class="token operator">=</span> LiteFlowMethodEnum<span class="token punctuation">.</span>PROCESS<span class="token punctuation">,</span> nodeType <span class="token operator">=</span> NodeTypeEnum<span class="token punctuation">.</span>COMMON<span class="token punctuation">)</span>  
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processA</span><span class="token punctuation">(</span>NodeComponent nodeComponent<span class="token punctuation">)</span><span class="token punctuation">{</span>  
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"processA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  

    <span class="token annotation punctuation">@LiteflowMethod</span><span class="token punctuation">(</span>value <span class="token operator">=</span> LiteFlowMethodEnum<span class="token punctuation">.</span>BEFORE_PROCESS<span class="token punctuation">,</span> nodeType <span class="token operator">=</span> NodeTypeEnum<span class="token punctuation">.</span>COMMON<span class="token punctuation">)</span>  
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">beforeA</span><span class="token punctuation">(</span>NodeComponent nodeComponent<span class="token punctuation">)</span><span class="token punctuation">{</span>  
        DataContext dataContext <span class="token operator">=</span> nodeComponent<span class="token punctuation">.</span><span class="token function">getContextBean</span><span class="token punctuation">(</span>DataContext<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"beforeA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  

    <span class="token annotation punctuation">@LiteflowMethod</span><span class="token punctuation">(</span>value <span class="token operator">=</span> LiteFlowMethodEnum<span class="token punctuation">.</span>AFTER_PROCESS<span class="token punctuation">,</span> nodeType <span class="token operator">=</span> NodeTypeEnum<span class="token punctuation">.</span>COMMON<span class="token punctuation">)</span>  
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterA</span><span class="token punctuation">(</span>NodeComponent nodeComponent<span class="token punctuation">)</span><span class="token punctuation">{</span>  
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"afterA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><p>条件组件<br>声明选择组件在类和方法上都需要加上<code>NodeTypeEnum.IF</code>参数。</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">"define_if"</span><span class="token punctuation">)</span>  
<span class="token annotation punctuation">@LiteflowCmpDefine</span><span class="token punctuation">(</span>NodeTypeEnum<span class="token punctuation">.</span>IF<span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyDefineIfCpm</span> <span class="token punctuation">{</span>  
  <span class="token annotation punctuation">@LiteflowMethod</span><span class="token punctuation">(</span>value <span class="token operator">=</span> LiteFlowMethodEnum<span class="token punctuation">.</span>PROCESS_IF<span class="token punctuation">,</span> nodeType <span class="token operator">=</span> NodeTypeEnum<span class="token punctuation">.</span>IF<span class="token punctuation">)</span>  
  <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">processIf</span><span class="token punctuation">(</span>NodeComponent nodeComponent<span class="token punctuation">)</span><span class="token punctuation">{</span> 
      DataContext dataContext <span class="token operator">=</span> nodeComponent<span class="token punctuation">.</span><span class="token function">getContextBean</span><span class="token punctuation">(</span>DataContext<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"执行if"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  
  <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>选择组件<br>声明选择组件在类和方法上都需要加上<code>NodeTypeEnum.SWITCH</code>参数。</p>
</li>
</ul>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">"define_w"</span><span class="token punctuation">)</span>  
<span class="token annotation punctuation">@LiteflowCmpDefine</span><span class="token punctuation">(</span>NodeTypeEnum<span class="token punctuation">.</span>SWITCH<span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyDefineSwitchCpm</span> <span class="token punctuation">{</span>  

    <span class="token annotation punctuation">@LiteflowMethod</span><span class="token punctuation">(</span>value <span class="token operator">=</span> LiteFlowMethodEnum<span class="token punctuation">.</span>PROCESS_SWITCH<span class="token punctuation">,</span> nodeType <span class="token operator">=</span> NodeTypeEnum<span class="token punctuation">.</span>SWITCH<span class="token punctuation">)</span>  
    <span class="token keyword">public</span> String <span class="token function">processSwitch1</span><span class="token punctuation">(</span>NodeComponent nodeComponent<span class="token punctuation">)</span><span class="token punctuation">{</span> 
        DataContext dataContext <span class="token operator">=</span> nodeComponent<span class="token punctuation">.</span><span class="token function">getContextBean</span><span class="token punctuation">(</span>DataContext<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"执行switch"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">return</span> <span class="token string">"b"</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><p>次数循环组件<br>声明选择组件在类和方法上都需要加上<code>NodeTypeEnum.FOR</code>参数。</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">"define_for"</span><span class="token punctuation">)</span>  
<span class="token annotation punctuation">@LiteflowCmpDefine</span><span class="token punctuation">(</span>NodeTypeEnum<span class="token punctuation">.</span>FOR<span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyDefineForCmp</span> <span class="token punctuation">{</span>  

  <span class="token annotation punctuation">@LiteflowMethod</span><span class="token punctuation">(</span>value <span class="token operator">=</span> LiteFlowMethodEnum<span class="token punctuation">.</span>PROCESS_FOR<span class="token punctuation">,</span> nodeType <span class="token operator">=</span> NodeTypeEnum<span class="token punctuation">.</span>FOR<span class="token punctuation">)</span>  
  <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">processFor</span><span class="token punctuation">(</span>NodeComponent nodeComponent<span class="token punctuation">)</span><span class="token punctuation">{</span>  
      DataContext dataContext <span class="token operator">=</span> nodeComponent<span class="token punctuation">.</span><span class="token function">getContextBean</span><span class="token punctuation">(</span>DataContext<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"执行for"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token keyword">return</span> <span class="token number">10</span><span class="token punctuation">;</span>  
  <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>条件循环组件<br>声明选择组件在类和方法上都需要加上<code>NodeTypeEnum.WHILE</code>参数。</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">"define_while"</span><span class="token punctuation">)</span>  
<span class="token annotation punctuation">@LiteflowCmpDefine</span><span class="token punctuation">(</span>NodeTypeEnum<span class="token punctuation">.</span>WHILE<span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyDefineWhileCmp</span> <span class="token punctuation">{</span>  

  <span class="token annotation punctuation">@LiteflowMethod</span><span class="token punctuation">(</span>value <span class="token operator">=</span> LiteFlowMethodEnum<span class="token punctuation">.</span>PROCESS_WHILE<span class="token punctuation">,</span> nodeType <span class="token operator">=</span> NodeTypeEnum<span class="token punctuation">.</span>WHILE<span class="token punctuation">)</span>  
  <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">processWhile</span><span class="token punctuation">(</span>NodeComponent nodeComponent<span class="token punctuation">)</span><span class="token punctuation">{</span>  
      DataContext dataContext <span class="token operator">=</span> nodeComponent<span class="token punctuation">.</span><span class="token function">getContextBean</span><span class="token punctuation">(</span>DataContext<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"执行while"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  
  <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>迭代循环组件<br>声明选择组件在类和方法上都需要加上<code>NodeTypeEnum.ITERATOR</code>参数。</p>
</li>
</ul>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">"define_iterator"</span><span class="token punctuation">)</span>  
<span class="token annotation punctuation">@LiteflowCmpDefine</span><span class="token punctuation">(</span>NodeTypeEnum<span class="token punctuation">.</span>ITERATOR<span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyDefineIteratorCpm</span> <span class="token punctuation">{</span>  

<span class="token annotation punctuation">@LiteflowMethod</span><span class="token punctuation">(</span>value <span class="token operator">=</span> LiteFlowMethodEnum<span class="token punctuation">.</span>PROCESS_ITERATOR<span class="token punctuation">,</span> nodeType <span class="token operator">=</span> NodeTypeEnum<span class="token punctuation">.</span>ITERATOR<span class="token punctuation">)</span>  
<span class="token keyword">public</span> Iterator<span class="token operator">&lt;</span>String<span class="token operator">></span> <span class="token function">processSwitch1</span><span class="token punctuation">(</span>NodeComponent nodeComponent<span class="token punctuation">)</span><span class="token punctuation">{</span>  
        DataContext dataContext <span class="token operator">=</span> nodeComponent<span class="token punctuation">.</span><span class="token function">getContextBean</span><span class="token punctuation">(</span>DataContext<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"执行iterator"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">return</span> dataContext<span class="token punctuation">.</span><span class="token function">getDataList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><p>退出循环组件<br>声明选择组件在类和方法上都需要加上<code>NodeTypeEnum.BREAK</code>参数。</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">"define_break"</span><span class="token punctuation">)</span>  
<span class="token annotation punctuation">@LiteflowCmpDefine</span><span class="token punctuation">(</span>NodeTypeEnum<span class="token punctuation">.</span>BREAK<span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyDefineWhileCmp</span> <span class="token punctuation">{</span>  

  <span class="token annotation punctuation">@LiteflowMethod</span><span class="token punctuation">(</span>value <span class="token operator">=</span> LiteFlowMethodEnum<span class="token punctuation">.</span>PROCESS_BREAK<span class="token punctuation">,</span> nodeType <span class="token operator">=</span> NodeTypeEnum<span class="token punctuation">.</span>BREAK<span class="token punctuation">)</span>  
  <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">processBreak</span><span class="token punctuation">(</span>NodeComponent nodeComponent<span class="token punctuation">)</span><span class="token punctuation">{</span>  
      DataContext dataContext <span class="token operator">=</span> nodeComponent<span class="token punctuation">.</span><span class="token function">getContextBean</span><span class="token punctuation">(</span>DataContext<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"执行break"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  
  <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
<h5 id="方法级别式声明"><a href="#方法级别式声明" class="headerlink" title="方法级别式声明"></a>方法级别式声明</h5><p>因为类级别式声明还是会造成类定义过多的问题，<code>LiteFlow</code>又提供了方法级别式声明。方法级别式声明可以让在一个类中通过注解定义多个组件。在类上使用<code>@LiteflowComponent</code>进行声明这是一个组件类，然后在方法使用<code>@LiteflowMethod</code>声明方法是一个组件节点。如下：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span>  
<span class="token annotation punctuation">@LiteflowComponent</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderHandlerCmp</span> <span class="token punctuation">{</span>  


    <span class="token comment" spellcheck="true">/**  
    * 普通组件 等价于 继承`NodeComponent` 实现process()方法  
    * @param nodeComponent  
    */</span>  
    <span class="token annotation punctuation">@LiteflowMethod</span><span class="token punctuation">(</span>nodeType <span class="token operator">=</span> NodeTypeEnum<span class="token punctuation">.</span>COMMON<span class="token punctuation">,</span> value <span class="token operator">=</span> LiteFlowMethodEnum<span class="token punctuation">.</span>PROCESS<span class="token punctuation">,</span> nodeId <span class="token operator">=</span> <span class="token string">"common"</span><span class="token punctuation">,</span> nodeName <span class="token operator">=</span> <span class="token string">"普通组件"</span><span class="token punctuation">)</span>  
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processCommon</span><span class="token punctuation">(</span>NodeComponent nodeComponent<span class="token punctuation">)</span><span class="token punctuation">{</span>  
        <span class="token comment" spellcheck="true">// 业务逻辑  </span>
    <span class="token punctuation">}</span>  

    <span class="token comment" spellcheck="true">/**  
    * IF组件 等价于 继承 `NodeIfComponent` 实现processIf()方法  
    * @param nodeComponent  
    * @return  
    */</span>  
    <span class="token annotation punctuation">@LiteflowMethod</span><span class="token punctuation">(</span>nodeType <span class="token operator">=</span> NodeTypeEnum<span class="token punctuation">.</span>IF<span class="token punctuation">,</span> value <span class="token operator">=</span> LiteFlowMethodEnum<span class="token punctuation">.</span>PROCESS_IF<span class="token punctuation">,</span> nodeId <span class="token operator">=</span> <span class="token string">"if"</span><span class="token punctuation">,</span> nodeName <span class="token operator">=</span> <span class="token string">"IF组件"</span><span class="token punctuation">)</span>  
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">processIf</span><span class="token punctuation">(</span>NodeComponent nodeComponent<span class="token punctuation">)</span><span class="token punctuation">{</span>  
        <span class="token comment" spellcheck="true">// 业务逻辑  </span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  

    <span class="token comment" spellcheck="true">/**  
    * SWITCH组件 等价于 继承 `NodeSwitchComponent` 实现processSwitch()方法  
    * @param nodeComponent  
    * @return  
    */</span>  
    <span class="token annotation punctuation">@LiteflowMethod</span><span class="token punctuation">(</span>nodeType <span class="token operator">=</span> NodeTypeEnum<span class="token punctuation">.</span>SWITCH<span class="token punctuation">,</span> value <span class="token operator">=</span> LiteFlowMethodEnum<span class="token punctuation">.</span>PROCESS_SWITCH<span class="token punctuation">,</span> nodeId <span class="token operator">=</span> <span class="token string">"switch"</span><span class="token punctuation">,</span> nodeName <span class="token operator">=</span> <span class="token string">"SWITCH组件"</span><span class="token punctuation">)</span>  
    <span class="token keyword">public</span> String <span class="token function">processSwitch</span><span class="token punctuation">(</span>NodeComponent nodeComponent<span class="token punctuation">)</span><span class="token punctuation">{</span>  
        <span class="token comment" spellcheck="true">// 业务逻辑  </span>
        <span class="token keyword">return</span> <span class="token string">"nodeId"</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  

    <span class="token comment" spellcheck="true">/**  
    * 次数循环组件 等价于 继承 `NodeForComponent` 实现processFor()方法  
    * @param nodeComponent  
    * @return  
    */</span>  
    <span class="token annotation punctuation">@LiteflowMethod</span><span class="token punctuation">(</span>nodeType <span class="token operator">=</span> NodeTypeEnum<span class="token punctuation">.</span>FOR<span class="token punctuation">,</span> value <span class="token operator">=</span> LiteFlowMethodEnum<span class="token punctuation">.</span>PROCESS_FOR<span class="token punctuation">,</span> nodeId <span class="token operator">=</span> <span class="token string">"for"</span><span class="token punctuation">,</span> nodeName <span class="token operator">=</span> <span class="token string">"FOR组件"</span><span class="token punctuation">)</span>  
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">processFor</span><span class="token punctuation">(</span>NodeComponent nodeComponent<span class="token punctuation">)</span><span class="token punctuation">{</span>  
    <span class="token comment" spellcheck="true">// 业务逻辑  </span>
    <span class="token keyword">return</span> <span class="token number">10</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  

    <span class="token comment" spellcheck="true">/**  
    * 条件循环组件 等价于 继承 `NodeWhileComponent` 实现processWhile()方法  
    * @param nodeComponent  
    * @return  
    */</span>  
    <span class="token annotation punctuation">@LiteflowMethod</span><span class="token punctuation">(</span>nodeType <span class="token operator">=</span> NodeTypeEnum<span class="token punctuation">.</span>WHILE<span class="token punctuation">,</span> value <span class="token operator">=</span> LiteFlowMethodEnum<span class="token punctuation">.</span>PROCESS_WHILE<span class="token punctuation">,</span> nodeId <span class="token operator">=</span> <span class="token string">"while"</span><span class="token punctuation">,</span> nodeName <span class="token operator">=</span> <span class="token string">"WHILE组件"</span><span class="token punctuation">)</span>  
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">processWhile</span><span class="token punctuation">(</span>NodeComponent nodeComponent<span class="token punctuation">)</span><span class="token punctuation">{</span>  
        <span class="token comment" spellcheck="true">// 业务逻辑  </span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  

    <span class="token comment" spellcheck="true">/**  
    * 迭代循环组件 等价于 继承 `NodeIteratorComponent` processIterator()方法  
    * @param nodeComponent  
    * @return  
    */</span>  
    <span class="token annotation punctuation">@LiteflowMethod</span><span class="token punctuation">(</span>nodeType <span class="token operator">=</span> NodeTypeEnum<span class="token punctuation">.</span>ITERATOR<span class="token punctuation">,</span> value <span class="token operator">=</span> LiteFlowMethodEnum<span class="token punctuation">.</span>PROCESS_ITERATOR<span class="token punctuation">,</span> nodeId <span class="token operator">=</span> <span class="token string">"iterator"</span><span class="token punctuation">,</span> nodeName <span class="token operator">=</span> <span class="token string">"ITERATOR组件"</span><span class="token punctuation">)</span>  
    <span class="token keyword">public</span> Iterator<span class="token operator">&lt;</span>Object<span class="token operator">></span> <span class="token function">processIterator</span><span class="token punctuation">(</span>NodeComponent nodeComponent<span class="token punctuation">)</span><span class="token punctuation">{</span>  
    <span class="token comment" spellcheck="true">// 业务逻辑  </span>
    List<span class="token operator">&lt;</span>Object<span class="token operator">></span> list <span class="token operator">=</span> Lists<span class="token punctuation">.</span><span class="token function">newArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">return</span> list<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  

    <span class="token comment" spellcheck="true">/**  
    * 跳出循环组件 等价于 继承 `NodeBreakComponent` processBreak()方法  
    * @param nodeComponent  
    * @return  
    */</span>  
    <span class="token annotation punctuation">@LiteflowMethod</span><span class="token punctuation">(</span>nodeType <span class="token operator">=</span> NodeTypeEnum<span class="token punctuation">.</span>BREAK<span class="token punctuation">,</span> value <span class="token operator">=</span> LiteFlowMethodEnum<span class="token punctuation">.</span>PROCESS_BREAK<span class="token punctuation">,</span> nodeId <span class="token operator">=</span> <span class="token string">"break"</span><span class="token punctuation">,</span> nodeName <span class="token operator">=</span> <span class="token string">"BREAK组件"</span><span class="token punctuation">)</span>  
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">processBreak</span><span class="token punctuation">(</span>NodeComponent nodeComponent<span class="token punctuation">)</span><span class="token punctuation">{</span>  
        <span class="token comment" spellcheck="true">// 业务逻辑  </span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>对于方法级别声明特性来说，<code>@LiteflowMethod</code>注解上的<code>nodeId</code>一定要写。<code>nodeName</code>的属性。方便对声明式的组件进行命名。定义方法时，返回值要和常规组件里的对应方法返回值一致。例如普通组件的<code>process</code>方法是不返回的，比如IF组件的<code>processIf</code>方法是返回布尔值的。如果写错误，会造成一些异常。。。。</p>
<blockquote>
<p>我个人是比较喜欢用这种方式进行组件的定义，可以按照业务逻辑将代码拆分成一个个的模块，在各自的模块中进行业务逻辑的实现，也会非常清晰。</p>
</blockquote>
<h4 id="EL规则"><a href="#EL规则" class="headerlink" title="EL规则"></a>EL规则</h4><p><code>LiteFlow</code>2.8.x以后版本提供了一款强大的规则表达式。一切复杂的流程在<code>LiteFlow</code>表达式的加持下，都变得非常简便明了。配合一些流程图简直是通熟易懂。让整个业务流程在处理上看起来并没有那么黑盒。它可以设置各种编排规则，包括：</p>
<ul>
<li>串行编排<br>串行编排，即组件要顺序执行，使用<code>THEN</code>关键字，<strong><code>THEN</code>必须大写</strong></li>
</ul>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>thenchain<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  
    THEN(a, b, c);  
    THEN(a, THEN(b, c));  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>并行编排<br>并行编排即并行执行若干个个组件，使用用<code>WHEN</code>关键字，<strong><code>WHEN</code>必须大写。</strong></li>
</ul>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>whenchain<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  
    WTHEN(a, b, c);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>当然，<code>WHEN</code>跟<code>THEN</code>还可以结合使用:</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>testChain<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  
    THEN(a, WHEN(b, c, d), e);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>当a节点执行完成之后，并行执行b,c,d节点，完成之后在执行e节点。<br><img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/blogcontent/20240129143222.png" alt="image.png"></p>
<p><img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/blogcontent/20240129153713.png" alt="image.png"></p>
<p>我们在看到并行执行的时候，就会联想到多线程处理，那么<code>LiteFlow</code>是怎么创建多线程的呢？答案是<code>LiteFlow</code>内部默认维护了一个<code>when</code>线程池，这个线程池是供给所有<code>WHEN</code>流程使用的。当然你可以在<code>LiteFlow</code>执行器执行之前给你的流程通过<code>LiteflowConfig</code>传入一些线程池参数或者实现<code>ExecutorBuilder</code>接口，自定义线程池。比如：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LiteFlowThreadPool</span> <span class="token keyword">implements</span> <span class="token class-name">ExecutorBuilder</span> <span class="token punctuation">{</span>  

    <span class="token annotation punctuation">@Override</span>  
    <span class="token keyword">public</span> ExecutorService <span class="token function">buildExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
        ThreadFactory threadFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setNameFormat</span><span class="token punctuation">(</span><span class="token string">"mythread-pool-%s"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>  
                    <span class="token comment" spellcheck="true">// 核心线程数，即2个常开窗口  </span>
                    <span class="token number">2</span><span class="token punctuation">,</span>  
                    <span class="token comment" spellcheck="true">// 最大的线程数，银行所有的窗口  </span>
                    <span class="token number">5</span><span class="token punctuation">,</span>  
                    <span class="token comment" spellcheck="true">// 空闲时间  </span>
                    <span class="token number">5</span><span class="token punctuation">,</span>  
                    TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">,</span>  
                    <span class="token comment" spellcheck="true">// 工作队列  </span>
                    <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
                    <span class="token comment" spellcheck="true">// 线程工厂  </span>
                    threadFactory<span class="token punctuation">,</span>  
                    <span class="token comment" spellcheck="true">// 拒绝策略  </span>
                    <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor<span class="token punctuation">.</span>AbortPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
        <span class="token punctuation">)</span><span class="token punctuation">;</span>  

    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后我们在<code>LiteflowConfig</code>设置并行线程执行器class路径<code>threadExecutorClass</code>:</p>
<pre class="line-numbers language-java"><code class="language-java">LiteflowConfig liteflowConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LiteflowConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
liteflowConfig<span class="token punctuation">.</span><span class="token function">setThreadExecutorClass</span><span class="token punctuation">(</span><span class="token string">"LiteFlowThreadPool的类路径"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
flowExecutor<span class="token punctuation">.</span><span class="token function">setLiteflowConfig</span><span class="token punctuation">(</span>liteflowConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>  
LiteflowResponse response <span class="token operator">=</span> flowExecutor<span class="token punctuation">.</span><span class="token function">execute2Resp</span><span class="token punctuation">(</span><span class="token string">"testChain"</span><span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>执行结果，可以看见线程池使用的是自定义的：<br><img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/blogcontent/20240129161642.png" alt="image.png"></p>
<blockquote>
<p>LiteFlow从2.11.1开始，提供一个<code>liteflow.when-thread-pool-isolate</code>参数，默认为<code>false</code>，如果设为<code>true</code>，则会开启WHEN的线程池隔离机制，这意味着每一个when都会有单独的线程池。</p>
</blockquote>
<p>在多线程执行下，我们还有一个疑问，如果其中某个或者某几个并行分支发生异常执行失败那么后面的节点会不会收到影响？假如我们把C节点抛出一个异常，发现流程直接就结束了，并没有执行最后的E节点：<br><img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/blogcontent/20240129162750.png" alt="image.png"><br>对于这种情况，<code>LiteFlow</code>的<code>WHEN</code>关键字提供了<code>ignoreError</code>(默认为false)来提供忽略错误的特性。我们修改流程如下：</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>testChain<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  
    THEN(test_a, WHEN(test_b, test_c, test_d).ignoreError(true), test_e);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>再次执行发现流程执行到了E节点：<br><img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/blogcontent/20240129163209.png" alt="image.png"></p>
<p><code>LiteFlow</code>还提供了对<code>WHEN</code>并行流程中，使用子关键字<code>any</code>(默认为false)可以设置任一条分支先执行完即忽略其他分支，继续执行的特性。</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>testChain<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  
    THEN(test_a, WHEN(test_b, test_c, test_d).ignoreError(true).any(true), test_e);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>我们将C节点Sleep 10秒，可以发现C节点并没有执行，就执行到了E节点：<br><img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/blogcontent/20240129170000.png" alt="image.png"></p>
<p>除此之外，<code>LiteFlow</code>还支持了并行编排中指定节点的执行则忽略其他，<code>WHEN</code>关键字子关键字 <code>must</code> (不可为空)，可用于指定需等待执行的任意节点，可以为 1 个或者多个，若指定的所有节点率先完成，则继续往下执行，忽略同级别的其他任务。我们将流程调节如下：</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>testChain<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  
    THEN(test_a, WHEN(test_b, test_c, test_d).ignoreError(true).must(test_c), test_e);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>我们还是将C节点Sleep 10秒，发现流程一直等到C节点执行结束才会执行后面的节点：<br><img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/blogcontent/20240129171707.png" alt="image.png"></p>
<blockquote>
<p>must子关键字在LiteFlow从v2.11.1版本之后才有。</p>
</blockquote>
<ul>
<li>选择编排<br>在实现业务逻辑过程中，我们常见的就是根据某种标识去进行不同的业务流程，通常我们也可以使用策略模式进行实现。在<code>LiteFlow</code>中可以通过<code>SWITCH..TO()</code>选择编排，即<code>SWITCH</code>中的流程返回后面TO中那个节点就会执行那个节点，我们只需要处理好<code>SWITCH</code>中条件于TO中分支的关系即可。增加一个<code>Switch</code>组件：</li>
</ul>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@LiteflowMethod</span><span class="token punctuation">(</span>value <span class="token operator">=</span> LiteFlowMethodEnum<span class="token punctuation">.</span>PROCESS_SWITCH<span class="token punctuation">,</span> nodeType <span class="token operator">=</span> NodeTypeEnum<span class="token punctuation">.</span>SWITCH<span class="token punctuation">,</span> nodeId <span class="token operator">=</span> <span class="token string">"test_w"</span><span class="token punctuation">,</span> nodeName <span class="token operator">=</span> <span class="token string">"测试组件W"</span><span class="token punctuation">)</span>  
<span class="token keyword">public</span> String <span class="token function">processSwitch</span><span class="token punctuation">(</span>NodeComponent nodeComponent<span class="token punctuation">)</span><span class="token punctuation">{</span>  
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"执行W节点"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">return</span> <span class="token string">"test_a"</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后我们规则编排：</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>testSwitchChain<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  
    SWITCH(test_w).TO(test_a, test_b, test_c, test_d, test_e);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>执行流程：<br><img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/blogcontent/20240129180607.png" alt="image.png"></p>
<p><code>SWITCH</code>还提供了子关键字<code>DEFAULT</code>，如果<code>SWITCH</code>返回的节点不是TO中的节点，则就走DEFAULT中指定的节点。</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>testSwitchChain<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  
    SWITCH(test_w).TO(test_a, test_b, test_c, test_d, test_e).DEFAULT(test_y);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/blogcontent/20240129194449.png" alt="image.png"></p>
<p>由选择组件章节中我们知道，<code>SWITCH</code>可以返回ID或者链路Tag，上述例子中返回的<code>test_a</code>就是一个节点ID(对应<code>@LiteflowMethod</code>中指定的nodeId中的值)。当让在规则中我们也可以给表达式设置一个id。<code>LiteFlow</code>中规定，每个表达式都可以有一个id值，你可以设置id值来设置一个表达式的id值。然后在选择组件里返回这个id即可。</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>testSwitchChain<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  
    SWITCH(test_w).TO(test_a, THEN(test_b, test_c, test_d).id("test_bcd"), test_e).DEFAULT(test_y);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>假如此时<code>test_w</code>表达式返回的是<code>test_bcd</code>,则流程就会执行<code>test_b</code>, <code>test_c</code>, <code>test_d</code>节点：<br><img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/blogcontent/20240129195541.png" alt="image.png"></p>
<p>除了给表达式赋值<code>id</code>属性之外，还可以给表达式赋值<code>tag</code>属性。在<code>SWITCH</code>中返回<code>tag</code>。</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>testSwitchChain<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  
    SWITCH(test_w).TO(test_a, THEN(test_b, test_c, test_d).tag("test_tag"), test_e).DEFAULT(test_y);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>我们<code>SWITCH</code>组件中返回tag标签：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@LiteflowMethod</span><span class="token punctuation">(</span>value <span class="token operator">=</span> LiteFlowMethodEnum<span class="token punctuation">.</span>PROCESS_SWITCH<span class="token punctuation">,</span> nodeType <span class="token operator">=</span> NodeTypeEnum<span class="token punctuation">.</span>SWITCH<span class="token punctuation">,</span> nodeId <span class="token operator">=</span> <span class="token string">"test_w"</span><span class="token punctuation">,</span> nodeName <span class="token operator">=</span> <span class="token string">"测试组件W"</span><span class="token punctuation">)</span>  
<span class="token keyword">public</span> String <span class="token function">processSwitch</span><span class="token punctuation">(</span>NodeComponent nodeComponent<span class="token punctuation">)</span><span class="token punctuation">{</span>  
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"执行W节点"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">return</span> <span class="token string">"tag:test_tag"</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/blogcontent/20240129201425.png" alt="image.png"></p>
<ul>
<li>条件编排<br>条件编排类似Java中的if…else，它有<code>IF</code>，<code>IF...ELIF</code>，<code>ELSE</code>几种写法。其中IF以及ELIF中的表达式对应IF组件中返回的<code>boolean</code>结果。对与IF有二元表达式：</li>
</ul>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>testIfChain1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  
    IF(test_f, test_a);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><code>IF</code>后面还可以跟<code>ELSE</code>。类似Java中的<code>else</code>。</p>
<pre class="line-numbers language-xml"><code class="language-xml">

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>testIfChain<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  
    IF(test_f, test_a).ELSE(test_b);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>IF还支持三元表达式，上面的二元表达式等价于如下三元表达式写法：</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>testIfChain<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  
    IF(test_f, test_a, test_b);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>上面两种表达式都可以解读为：如果<code>test_f</code>中返回<code>true</code>则执行<code>test_a</code>节点，否则执行<code>test_b</code>节点。</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@LiteflowMethod</span><span class="token punctuation">(</span>value <span class="token operator">=</span> LiteFlowMethodEnum<span class="token punctuation">.</span>PROCESS_IF<span class="token punctuation">,</span> nodeType <span class="token operator">=</span> NodeTypeEnum<span class="token punctuation">.</span>IF<span class="token punctuation">,</span> nodeId <span class="token operator">=</span> <span class="token string">"test_f"</span><span class="token punctuation">,</span> nodeName <span class="token operator">=</span> <span class="token string">"测试组件F"</span><span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">processF</span><span class="token punctuation">(</span>NodeComponent nodeComponent<span class="token punctuation">)</span><span class="token punctuation">{</span>  
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"执行F节点"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/blogcontent/20240130102610.png" alt="image.png"></p>
<p>我们再看一下<code>ELIF</code>的写法，<code>ELIF</code>类似Java中的<code>else if</code>的写法，它的后面也可以跟<code>ELSE</code>。</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>testIfChain<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>   
    IF(test_f, test_a).ELIF(test_x, test_b);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>我们在订一个<code>test_x</code>的IF组件：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@LiteflowMethod</span><span class="token punctuation">(</span>value <span class="token operator">=</span> LiteFlowMethodEnum<span class="token punctuation">.</span>PROCESS_IF<span class="token punctuation">,</span> nodeType <span class="token operator">=</span> NodeTypeEnum<span class="token punctuation">.</span>IF<span class="token punctuation">,</span> nodeId <span class="token operator">=</span> <span class="token string">"test_f"</span><span class="token punctuation">,</span> nodeName <span class="token operator">=</span> <span class="token string">"测试组件F"</span><span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">processF</span><span class="token punctuation">(</span>NodeComponent nodeComponent<span class="token punctuation">)</span><span class="token punctuation">{</span>  
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"执行F节点"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  

<span class="token annotation punctuation">@LiteflowMethod</span><span class="token punctuation">(</span>value <span class="token operator">=</span> LiteFlowMethodEnum<span class="token punctuation">.</span>PROCESS_IF<span class="token punctuation">,</span> nodeType <span class="token operator">=</span> NodeTypeEnum<span class="token punctuation">.</span>IF<span class="token punctuation">,</span> nodeId <span class="token operator">=</span> <span class="token string">"test_x"</span><span class="token punctuation">,</span> nodeName <span class="token operator">=</span> <span class="token string">"测试组件X"</span><span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">processX</span><span class="token punctuation">(</span>NodeComponent nodeComponent<span class="token punctuation">)</span><span class="token punctuation">{</span>  
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"执行X节点"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/blogcontent/20240130110428.png" alt="image.png"></p>
<p><code>test_f</code>节点返回false，所以不会执行<code>test_a</code>，继续执行<code>test_x</code>节点，返回true，则会执行<code>test_b</code>节点。<br>当然<code>ELIF</code>后面也可以使用<code>ELSE</code>。</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>testIfChain<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>   
    IF(test_f, test_a).ELIF(test_x, test_b).ELSE(test_c);
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>此时如果<code>test_f</code>以及<code>test_x</code>都返回false，就会走<code>test_c</code>。<br><img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/blogcontent/20240130111319.png" alt="image.png"></p>
<p>值得注意的是，当我们使用<code>IF</code>的二元表达式时才会去跟上<code>ELIF</code>以及<code>ELSE</code>。如果是三元表达式我们不可以使用<code>ELIF</code>以及<code>ELSE</code>，会报错。</p>
<blockquote>
<p>在2.10.0以前可以使用，但是在<code>IF</code>中的最后一个表达式会被<code>ELIF</code>或者`ELSE中的表达式<br>覆盖掉。本人只调研到了2.10.0,在这个版本中还是会报错。</p>
</blockquote>
<ul>
<li>循环编排</li>
</ul>
<p>循环编排类似Java中的循环，分为次数循环(<code>FOR...DO()</code>)，条件循环(<code>WHILE...DO()</code>)以及迭代循环(<code>ITERATOR...DO()</code>)，同时还涉及跳出循环编排(<code>BREAK</code>)。<br>我们定义一个固定次数的FOR循环：</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>testForChain<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  
    FOR(3).DO(THEN(test_a, test_b));  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>此时会将<code>test_a</code>，<code>test_b</code>循环执行3次。<br><img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/blogcontent/20240130135626.png" alt="image.png"></p>
<p>当然实际开发中，我们需要搭配<code>FOR</code>循环组件使用，即在<code>FOR</code>循环中返回需要执行的次数：</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>testForChain<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  
    FOR(test_w).DO(THEN(test_a, test_b));  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>假如<code>test_w</code>组件中返回次数是3,则执行效果如上固定次数。</p>
<p>接下来我们看一下<code>WHILE</code>条件循环，<code>WHILE</code>的表达式需要结合<code>WHILE</code>组件使用，返回一个<br><code>boolean</code>类型的值，去控制循环的流程，如果为true则继续循环，否则结束循环。</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>testWhileChain<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  
    WHILE(test_h).DO(THEN(test_a, test_b));  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>接下来我们继续看一下迭代循环<code>ITERATOR</code>，类似于Java中的for循环。这里我们要配合<code>ITERATOR</code>组件使用，返回一个集合的迭代器。</p>
<p>我们定义一个迭代循环编排：</p>
<pre class="line-numbers language-xml"><code class="language-xml">&lt;chain name = "testIteratorChain">  
    ITERATOR(test_i).DO(test_p);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>然后我们在定义一个迭代组件以及一个普通组件用于打印集合中的元素：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@LiteflowMethod</span><span class="token punctuation">(</span>value <span class="token operator">=</span> LiteFlowMethodEnum<span class="token punctuation">.</span>PROCESS_ITERATOR<span class="token punctuation">,</span> nodeType <span class="token operator">=</span> NodeTypeEnum<span class="token punctuation">.</span>ITERATOR<span class="token punctuation">,</span> nodeId <span class="token operator">=</span> <span class="token string">"test_i"</span><span class="token punctuation">,</span> nodeName <span class="token operator">=</span> <span class="token string">"测试组件I"</span><span class="token punctuation">)</span>  
<span class="token keyword">public</span> Iterator<span class="token operator">&lt;</span>String<span class="token operator">></span> <span class="token function">processI</span><span class="token punctuation">(</span>NodeComponent nodeComponent<span class="token punctuation">)</span><span class="token punctuation">{</span>  
    List<span class="token operator">&lt;</span>String<span class="token operator">></span> list <span class="token operator">=</span> Lists<span class="token punctuation">.</span><span class="token function">newArrayList</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">,</span> <span class="token string">"B"</span><span class="token punctuation">,</span> <span class="token string">"C"</span><span class="token punctuation">,</span><span class="token string">"D"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">return</span> list<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  

<span class="token annotation punctuation">@LiteflowMethod</span><span class="token punctuation">(</span>value <span class="token operator">=</span> LiteFlowMethodEnum<span class="token punctuation">.</span>PROCESS<span class="token punctuation">,</span> nodeType <span class="token operator">=</span> NodeTypeEnum<span class="token punctuation">.</span>COMMON<span class="token punctuation">,</span> nodeId <span class="token operator">=</span> <span class="token string">"test_p"</span><span class="token punctuation">,</span> nodeName <span class="token operator">=</span> <span class="token string">"测试打印组件"</span><span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">printData</span><span class="token punctuation">(</span>NodeComponent nodeComponent<span class="token punctuation">)</span><span class="token punctuation">{</span>  
    String str <span class="token operator">=</span> nodeComponent<span class="token punctuation">.</span><span class="token function">getCurrLoopObj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/blogcontent/20240130143042.png" alt="image.png"></p>
<p>有循环编排，就相应的要有跳出循环编排，我们可以使用<code>BREAK</code>编排，配合<code>BREAK</code>组件使用。</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>testForChain<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  
    FOR(test_j).DO(THEN(test_a, test_b)).BREAK(test_break);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span>  

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>testWhileChain<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  
    WHILE(test_h).DO(THEN(test_a, test_b)).BREAK(test_break);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span>  

&lt;chain name = "testIteratorChain">  
    ITERATOR(test_i).DO(test_p).BREAK(test_break);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>我们以迭代循环跳出为例：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@LiteflowMethod</span><span class="token punctuation">(</span>value <span class="token operator">=</span> LiteFlowMethodEnum<span class="token punctuation">.</span>PROCESS_BREAK<span class="token punctuation">,</span> nodeType <span class="token operator">=</span> NodeTypeEnum<span class="token punctuation">.</span>BREAK<span class="token punctuation">,</span> nodeId <span class="token operator">=</span> <span class="token string">"test_break"</span><span class="token punctuation">,</span> nodeName <span class="token operator">=</span> <span class="token string">"测Break组件"</span><span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">processBreak</span><span class="token punctuation">(</span>NodeComponent nodeComponent<span class="token punctuation">)</span><span class="token punctuation">{</span>  
    String str <span class="token operator">=</span> nodeComponent<span class="token punctuation">.</span><span class="token function">getCurrLoopObj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">return</span> Objects<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"C"</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/blogcontent/20240130145553.png" alt="image.png"></p>
<p>即执行到C元素时返回true，跳出循环。</p>
<blockquote>
<p>LiteFlow从v2.9.0开始，提供了循环编排表达式组合。</p>
</blockquote>
<ul>
<li>异常捕获<br>EL表达式中还增加了异常捕获表达式，用于捕获节点中的异常。类似Java中的<code>try...catch</code>。用法为<code>CATCH</code>…<code>DO</code>(<code>DO</code>关键字非必须)，如果在<code>CATCH</code>的表达式中捕获到了异常，可以在<code>DO</code>表达式中的节点进行处理，可以使用<code>nodeComponent.getSlot().getException()</code>获取异常信息。但是有一点我们需要注意，假如我们使用了<code>CATCH</code>，如果其中的节点中发生了异常，那么我们在流程执行的结果中也会看到流程执行成功的标识(<code>isSuccess</code>=true)，可以理解，发生的异常被你捕获处理了。</li>
</ul>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>testCatchChain<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  
    CATCH(  
    THEN(test_a, test_b)  
    ).DO(test_catch);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>我们在<code>test_b</code>节点中手动抛出一个<code>RuntimeException</code>，在<code>test_catch</code>中使用<code>nodeComponent.getSlot().getException()</code>打印捕获到的异常，同时我们在流程执行结果中打印<code>isSuccess</code>看流程是否执行成功：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@LiteflowMethod</span><span class="token punctuation">(</span>value <span class="token operator">=</span> LiteFlowMethodEnum<span class="token punctuation">.</span>PROCESS<span class="token punctuation">,</span> nodeType <span class="token operator">=</span> NodeTypeEnum<span class="token punctuation">.</span>COMMON<span class="token punctuation">,</span> nodeId <span class="token operator">=</span> <span class="token string">"test_catch"</span><span class="token punctuation">,</span> nodeName <span class="token operator">=</span> <span class="token string">"测试Catch组件"</span><span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processCatch</span><span class="token punctuation">(</span>NodeComponent nodeComponent<span class="token punctuation">)</span><span class="token punctuation">{</span>  
    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"执行Catch节点，捕获到了异常\n"</span><span class="token punctuation">,</span> nodeComponent<span class="token punctuation">.</span><span class="token function">getSlot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Test</span>  
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testCatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  
    LiteflowResponse response <span class="token operator">=</span> flowExecutor<span class="token punctuation">.</span><span class="token function">execute2Resp</span><span class="token punctuation">(</span><span class="token string">"testCatchChain"</span><span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">"执行成功"</span> <span class="token operator">:</span> <span class="token string">"执行失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"结果中的异常信息："</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">getCause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/blogcontent/20240130152104.png" alt="image.png"><br><img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/blogcontent/20240130152151.png" alt="image.png"></p>
<p>可以看到<code>test_catch</code>打印了异常信息，同时我们可以看到流程执行结果中返回执行成功，没有异常信息。<br><img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/blogcontent/20240130152252.png" alt="image.png"></p>
<p>同时<code>CATCH</code>配合迭代循环还可以达到Java<code>forEach</code>循环的<code>continue</code>的效果。</p>
<pre class="line-numbers language-XML"><code class="language-XML"><chain name = "testIteratorCatchChain">  
    ITERATOR(test_i).DO(CATCH(THEN(test_pa, test_pb, test_pc)));  
</chain><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>我们在<code>test_pb</code>在打印C时抛出异常</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@LiteflowMethod</span><span class="token punctuation">(</span>value <span class="token operator">=</span> LiteFlowMethodEnum<span class="token punctuation">.</span>PROCESS<span class="token punctuation">,</span> nodeType <span class="token operator">=</span> NodeTypeEnum<span class="token punctuation">.</span>COMMON<span class="token punctuation">,</span> nodeId <span class="token operator">=</span> <span class="token string">"test_pb"</span><span class="token punctuation">,</span> nodeName <span class="token operator">=</span> <span class="token string">"测试打印组件B"</span><span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">printPB</span><span class="token punctuation">(</span>NodeComponent nodeComponent<span class="token punctuation">)</span><span class="token punctuation">{</span>  
    String str <span class="token operator">=</span> nodeComponent<span class="token punctuation">.</span><span class="token function">getCurrLoopObj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"B组件打印："</span><span class="token operator">+</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Objects<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"B"</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"B组件发生异常了。。。。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/blogcontent/20240130155121.png" alt="image.png"><br><img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/blogcontent/20240130155133.png" alt="image.png"></p>
<p>此时没有执行C组件打印B，直接跳过了<code>test_pc</code>节点。</p>
<blockquote>
<p>LiteFlow从2.10.0开始提供CATCH表达式</p>
</blockquote>
<ul>
<li>与或非表达式<br>与或非表达式即<code>AND</code>，<code>OR</code>，<code>NOT</code>表达式。可以用于返回<code>boolean</code>值的组件的编排。可以将若干个这种组件编排在一起返回应该boolean值进行后续流程的判断。</li>
</ul>
<pre class="line-numbers language-xml"><code class="language-xml">&lt;chain name = "testAndOrNotChain">  
    IF(AND(test_f, test_x), test_a, test_c);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>此时只有<code>test_f</code>和<code>test_x</code> 节点都返回true，就会走<code>test_a</code>，否则走<code>test_c</code>。</p>
<pre class="line-numbers language-xml"><code class="language-xml">&lt;chain name = "testAndOrNotChain">  
    IF(OR(test_f, test_x), test_a, test_c);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>如果是OR，<code>test_f</code>和<code>test_x</code> 节点都返回false，就会走<code>test_c</code>，否则走<code>test_c</code>。</p>
<pre class="line-numbers language-xml"><code class="language-xml">&lt;chain name = "testAndOrNotChain">  
    IF(NOT(test_f), test_a, test_c);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><code>NOT</code>即非的意思，如果<code>test_f</code>返回true，则就会走<code>test_c</code>节点，否则走<code>test_a</code>节点。</p>
<p><code>AND</code>，<code>OR</code>，<code>NOT</code>三种表达式可以相互组合使用。但是只能用于返回<code>boolean</code>值的组件上。</p>
<ul>
<li>子流程<br>在日常处理复杂业务时，流程编排的规则会嵌套很多层，可以想象一下那样的流程读起来也比较头疼，而且事实上我们在开发中是需要将复杂的流程业务去拆分成一个个独立的子流程去实现。<br><img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/blogcontent/20240130170244.png" alt="image.png"></li>
</ul>
<p>如上图它的规则如下：</p>
<pre class="line-numbers language-xml"><code class="language-xml">&lt;chain name = "order_handle">  
THEN(  
    SWITCH(order_x).TO(  
    THEN(  
        order_a,  
        order_c,  
        IF(  
            order_k,  
                THEN(  
                    order_d,  
                    order_f  
                ),  
            order_e)  
        ).id("to_c"),  
    THEN(  
        order_b,  
        order_c,  
            IF(  
                order_k,  
                THEN(  
                    order_d,  
                    order_f  
            ),  
        order_e)  
    ).id("to_b")  
    )  
);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这样写其实也可以，但是读起来理解起来不号。这时我们就可以子流程进行改造。我们按照<code>to_c</code>,<code>to_b</code>流程进行拆分。</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>order_handle<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    // 主流程  
    THEN(SWITCH(order_x).TO(THEN(to_c).id("to_c"), THEN(to_b).id("to_b")), order_h);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>order_if<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  
    IF(order_k, THEN(order_d, order_f), order_e);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span>  

&lt;chain name = "to_c">  
    THEN(order_a, order_c, order_if);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span>  

&lt;chain name = "to_b">  
    THEN(order_b, order_c, order_if);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这样流程上就清晰了很多。</p>
<ul>
<li>子变量<br>在复杂流程的编排上，我们不仅可以使用子流程，还可以使用子变量的方式。我们可以直接在流程中定义变量。如上述例子使用子变量可以改造为：</li>
</ul>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>order_handle<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  
    // 定义一个if节点处理df/e  
    order_if = IF(order_k, THEN(order_d, order_f), order_e);  

    // 定义to_c的订单流程 用id标识流程为to_c  
    to_c = THEN(order_a, order_c, order_if).id("to_c");  

    // 定义to_b的订单流程 用id标识为流程to_b  
    to_b = THEN(order_b, order_c, order_if).id("to_b");  

    // 主流程  
    THEN(SWITCH(order_x).TO(to_c, to_b), order_h);  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chain</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这样也可以清晰。</p>
<ul>
<li>其他<br>我们在上述一些示例中，每个语句后都加了分号：<code>;</code>，关于规则中的分号，我们链路中只有一条规则的时候（没有自变量）可以不加也可以运行，但是如果存在自变量，一定要在自变量中加上分号，否则汇报错。同时官方也建议不管是否存在子变量，都要加上分号。</li>
</ul>
<p>另外，EL中我们使用<code>//</code>定义注释。</p>
<h4 id="执行器"><a href="#执行器" class="headerlink" title="执行器"></a>执行器</h4><p>在上述的一些示例中，我们使用了<code>flowExecutor</code>去执行规则。<code>FlowExecutor</code>就是流程的执行器，是一个流程执行的触发点。在<code>Spring</code>或者<code>SprigBoot</code>环境下我们可以直接注入<code>FlowExecutor</code>进行使用。<br><code>FlowExecutor</code>中提供同步以及异步两种类型的方法，同步方法直接返回<code>LiteflowResponse</code>，而异步返回的是<code>Future&lt;LiteflowResponse&gt;</code>。同步方法如下：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">//参数为流程ID，无初始流程入参，上下文类型为默认的DefaultContext</span>
<span class="token keyword">public</span> LiteflowResponse <span class="token function">execute2Resp</span><span class="token punctuation">(</span>String chainId<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//第一个参数为流程ID，第二个参数为流程入参。上下文类型为默认的DefaultContext</span>
<span class="token keyword">public</span> LiteflowResponse <span class="token function">execute2Resp</span><span class="token punctuation">(</span>String chainId<span class="token punctuation">,</span> Object param<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//第一个参数为流程ID，第二个参数为流程入参，后面可以传入多个上下文class</span>
<span class="token keyword">public</span> LiteflowResponse <span class="token function">execute2Resp</span><span class="token punctuation">(</span>String chainId<span class="token punctuation">,</span> Object param<span class="token punctuation">,</span> Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> contextBeanClazzArray<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//第一个参数为流程ID，第二个参数为流程入参，后面可以传入多个上下文的Bean</span>
<span class="token keyword">public</span> LiteflowResponse <span class="token function">execute2Resp</span><span class="token punctuation">(</span>String chainId<span class="token punctuation">,</span> Object param<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> contextBeanArray<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// 第一个参数为流程ID，第二个参数为流程入参，第三个参数是用户的RequestId，后面可以传入多个上下文的Bean</span>
<span class="token keyword">public</span> LiteflowResponse <span class="token function">execute2RespWithRid</span><span class="token punctuation">(</span>String chainId<span class="token punctuation">,</span> Object param<span class="token punctuation">,</span> String requestId<span class="token punctuation">,</span> Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> contextBeanClazzArray<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里我们一定要使用自定义上下文传入，不要使用默认上下文。</p>
<p>而异步方法跟同步方法是一样的，只是他是无阻塞。</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> Future<span class="token operator">&lt;</span>LiteflowResponse<span class="token operator">></span> <span class="token function">execute2Future</span><span class="token punctuation">(</span>String chainId<span class="token punctuation">,</span> Object param<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> contextBeanArray<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>同时，执行器可以针对异步执行提供了可配置的线程池参数，</p>
<pre class="line-numbers language-properties"><code class="language-properties"><span class="token comment" spellcheck="true">## FlowExecutor的execute2Future的线程数</span>
<span class="token attr-name">liteflow.main-executor-works</span><span class="token punctuation">=</span><span class="token attr-value">64</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>还可以使用自定义线程池，如果使用自定义线程池必须实现<code>ExecutorBuilder</code>接口，实现<code>ExecutorService buildExecutor()</code>接口。</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LiteFlowThreadPool</span> <span class="token keyword">implements</span> <span class="token class-name">ExecutorBuilder</span> <span class="token punctuation">{</span>  

<span class="token annotation punctuation">@Override</span>  
<span class="token keyword">public</span> ExecutorService <span class="token function">buildExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    ThreadFactory threadFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setNameFormat</span><span class="token punctuation">(</span><span class="token string">"mythread-pool-%s"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>  
            <span class="token comment" spellcheck="true">// 核心线程数，即2个常开窗口  </span>
            <span class="token number">2</span><span class="token punctuation">,</span>  
            <span class="token comment" spellcheck="true">// 最大的线程数，银行所有的窗口  </span>
            <span class="token number">5</span><span class="token punctuation">,</span>  
            <span class="token comment" spellcheck="true">// 空闲时间  </span>
            <span class="token number">5</span><span class="token punctuation">,</span>  
            TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">,</span>  
            <span class="token comment" spellcheck="true">// 工作队列  </span>
            <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
            <span class="token comment" spellcheck="true">// 线程工厂  </span>
            threadFactory<span class="token punctuation">,</span>  
            <span class="token comment" spellcheck="true">// 拒绝策略  </span>
            <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor<span class="token punctuation">.</span>AbortPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
    <span class="token punctuation">)</span><span class="token punctuation">;</span>  

    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>关于Java线程池的配置详解，请参考这篇文章：<a href="https://www.coderacademy.online/article/2d9d416b.html">重温Java基础（二）之Java线程池最全详解 | 码农Academy的博客 (coderacademy.online)</a></p>
</blockquote>
<p>我们可以通过<code>LiteFlow</code>的配置信息去设置:</p>
<pre class="line-numbers language-properties"><code class="language-properties"><span class="token comment" spellcheck="true">## FlowExecutor的execute2Future的自定义线程池的路径</span>
<span class="token attr-name">liteflow.main-executor-class</span><span class="token punctuation">=</span> <span class="token attr-value">com.springboot.litefolw.config.LiteFlowThreadPool</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>通过上述配置文件配置的信息，对全局的<code>FlowExecutor</code>都会生效，假如我们相对某一个执行器定义线程池内容，可以使用<code>LiteFlowConfig</code>类去的定义（通过配置文件中配置信息也会进入到这个类里）。</p>
<pre class="line-numbers language-java"><code class="language-java">LiteflowConfig liteflowConfig <span class="token operator">=</span> flowExecutor<span class="token punctuation">.</span><span class="token function">getLiteflowConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment" spellcheck="true">// FlowExecutor的execute2Future的自定义线程池的路径</span>
liteflowConfig<span class="token punctuation">.</span><span class="token function">setMainExecutorClass</span><span class="token punctuation">(</span><span class="token string">"com.springboot.litefolw.config.LiteFlowThreadPool"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment" spellcheck="true">// FlowExecutor的execute2Future的自定义线程池的路径</span>
liteflowConfig<span class="token punctuation">.</span><span class="token function">setMainExecutorWorks</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>这里不建议new一个LiteflowConfig去设置配置信息，这样可能会导致配置文件中的一些默认配置信息丢失。</p>
</blockquote>
<p>在一个流程执行时，我们需要传入一些参数例如订单号，账户信息等，这些信息会做初始参数传入到流程中。在执行器中我们可以使用上述<code>FlowExecutor</code>的方法中的第二个参数(Object param)传入流程入参参数。流程入参可以是任何对象，实际开发中，我们会将自己封装初始化好的Bean传入，然后可以在流程中使用<code>this.getRequestData()</code>或者<code>nodeCompoent.getRequestData()</code>。</p>
<pre class="line-numbers language-java"><code class="language-java">DataRequest dataRequest <span class="token operator">=</span> DataRequest<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iteratorRequestList</span><span class="token punctuation">(</span>Lists<span class="token punctuation">.</span><span class="token function">newArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
LiteflowResponse response <span class="token operator">=</span> 
<span class="token comment" spellcheck="true">// 流程传入参数</span>
flowExecutor<span class="token punctuation">.</span><span class="token function">execute2Resp</span><span class="token punctuation">(</span><span class="token string">"testIteratorCatchChain"</span><span class="token punctuation">,</span> dataRequest<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>在流程中获取入参参数：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@LiteflowComponent</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AComponent</span> <span class="token keyword">extends</span> <span class="token class-name">NodeComponent</span> <span class="token punctuation">{</span>  

    <span class="token annotation punctuation">@Override</span>  
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>  
        DataRequest dataRequest <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRequestData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>


<span class="token annotation punctuation">@Slf4j</span>  
<span class="token annotation punctuation">@LiteflowComponent</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestComponent</span> <span class="token punctuation">{</span>  

    <span class="token annotation punctuation">@LiteflowMethod</span><span class="token punctuation">(</span>value <span class="token operator">=</span> LiteFlowMethodEnum<span class="token punctuation">.</span>PROCESS<span class="token punctuation">,</span> nodeType <span class="token operator">=</span> NodeTypeEnum<span class="token punctuation">.</span>COMMON<span class="token punctuation">,</span> nodeId <span class="token operator">=</span> <span class="token string">"test_a"</span><span class="token punctuation">,</span> nodeName <span class="token operator">=</span> <span class="token string">"测试组件A"</span><span class="token punctuation">)</span>  
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processA</span><span class="token punctuation">(</span>NodeComponent nodeComponent<span class="token punctuation">)</span><span class="token punctuation">{</span>  
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"执行A节点"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        DataRequest dataRequest <span class="token operator">=</span> nodeComponent<span class="token punctuation">.</span><span class="token function">getRequestData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>理论上来说，流程入参可以是任何对象，但是我们不应该把数据上下文的实例当做参数传入。流程参数跟数据上下文是两个实例对象，流程入参只能通过<code>this.getRequestData()</code>去拿。</p>
</blockquote>
<p>最后我们来说一下流程执行的结果<code>LiteflowResponse</code>。异步执行的流程可以通过<code>future.get()</code>获取。我们简单介绍一下其中常用的一些方法：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LiteflowResponse</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 判断流程是否执行成功</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// 如果流程执行不成功，可以获取流程的异常信息，这个跟isSuccess()使用，很有用</span>
    <span class="token keyword">public</span> Exception <span class="token function">getCause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// 获取流程的执行步骤</span>
    <span class="token keyword">public</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>CmpStep<span class="token operator">>></span> <span class="token function">getExecuteSteps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// 获取流程的执行的队列信息</span>
    <span class="token keyword">public</span> Queue<span class="token operator">&lt;</span>CmpStep<span class="token operator">></span> <span class="token function">getRollbackStepQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// 获取流程的执行步骤的字符串信息。这个值在流程执行结束后,liteflow日志也会自动打印</span>
    <span class="token keyword">public</span> String <span class="token function">getExecuteStepStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    

    <span class="token comment" spellcheck="true">// 获取数据上下文信息</span>
    <span class="token keyword">public</span> <span class="token operator">&lt;</span>T<span class="token operator">></span> T <span class="token function">getContextBean</span><span class="token punctuation">(</span>Class<span class="token operator">&lt;</span>T<span class="token operator">></span> contextBeanClazz<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="数据上下文"><a href="#数据上下文" class="headerlink" title="数据上下文"></a>数据上下文</h4><p>数据上下文对与整个<code>LiteFlow</code>来说是非常重要的，从LiteFlow的简介中我们知道LiteFlow的主要功能是业务解耦，那么解耦中很重要的一步就是数据解耦。要做编排，就要消除各个组件中的差异性，组件不接收业务参数，也不会返回业务数据，每个组件只需要从数据上下文中获取自己关心的数据，不用关心此数据是由谁提供的，同样的，每个组件也只需要把自己执行所产生的结果数据放到数据上下文中，也不用关心此数据到底是提供给谁用的。这样就在一定程度上做到了数据解耦。数据上下文进入流程中后，整个链路中的任一节点都可以取到。不同的流程，数据上下文实例是完全隔离开的。</p>
<p>LiteFlow虽然也提供了默认的数据上下文<code>DefaultContext</code>，但是实际开发中不建议使用。我们要传入自己自定义的数据上下文对象，同流程入参，我们可以使用任意的Bean作为数据上下文传入到流程中。我们可以定义好若干个数据上下文对象的class传入到流程中，LiteFlow会在调用时进行初始化，给这个上下文分配唯一的实例。</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 传入一个</span>
LiteflowResponse response <span class="token operator">=</span> flowExecutor<span class="token punctuation">.</span><span class="token function">execute2Resp</span><span class="token punctuation">(</span><span class="token string">"chain1"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DataRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DataContext<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 传入多个</span>
LiteflowResponse response <span class="token operator">=</span> flowExecutor<span class="token punctuation">.</span><span class="token function">execute2Resp</span><span class="token punctuation">(</span><span class="token string">"chain1"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DataRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DataContext<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> OrderContext<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>我们还可以将已经初始化好的Bean作为数据上下文传入到流程当中：</p>
<pre class="line-numbers language-java"><code class="language-java">DataContext dataContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment" spellcheck="true">// 传入一个</span>
LiteflowResponse response <span class="token operator">=</span> flowExecutor<span class="token punctuation">.</span><span class="token function">execute2Resp</span><span class="token punctuation">(</span><span class="token string">"chain1"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DataRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dataContext<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 传入多个</span>
OrderContext orderContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
LiteflowResponse response <span class="token operator">=</span> flowExecutor<span class="token punctuation">.</span><span class="token function">execute2Resp</span><span class="token punctuation">(</span><span class="token string">"chain1"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DataRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dataContext<span class="token punctuation">,</span> orderContext<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>但是有一点要非常注意：<strong>框架并不支持上下文bean和class混传，你要么都传bean，要么都传class。</strong></p>
<p>然后我们就可以在链路的任意节点中通过以下方式获取数据上下文：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span>  
<span class="token annotation punctuation">@LiteflowComponent</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestComponent</span> <span class="token punctuation">{</span>  

<span class="token annotation punctuation">@LiteflowMethod</span><span class="token punctuation">(</span>value <span class="token operator">=</span> LiteFlowMethodEnum<span class="token punctuation">.</span>PROCESS<span class="token punctuation">,</span> nodeType <span class="token operator">=</span> NodeTypeEnum<span class="token punctuation">.</span>COMMON<span class="token punctuation">,</span> nodeId <span class="token operator">=</span> <span class="token string">"test_a"</span><span class="token punctuation">,</span> nodeName <span class="token operator">=</span> <span class="token string">"测试组件A"</span><span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processA</span><span class="token punctuation">(</span>NodeComponent nodeComponent<span class="token punctuation">)</span><span class="token punctuation">{</span>  
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"执行A节点"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    DataContext dataContext <span class="token operator">=</span> nodeComponent<span class="token punctuation">.</span><span class="token function">getContextBean</span><span class="token punctuation">(</span>DataContext<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    OrderContext orderContext <span class="token operator">=</span> nodeComponent<span class="token punctuation">.</span><span class="token function">getContextBean</span><span class="token punctuation">(</span>OrderContext<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token annotation punctuation">@LiteflowComponent</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AComponent</span> <span class="token keyword">extends</span> <span class="token class-name">NodeComponent</span> <span class="token punctuation">{</span>  

    <span class="token annotation punctuation">@Override</span>  
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>   
        DataContext dataContext <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getContextBean</span><span class="token punctuation">(</span>DataContext<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        OrderContext orderContext <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getContextBean</span><span class="token punctuation">(</span>OrderContext<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>到此，SpringBoot环境下LiteFlow的一些基本概念就介绍完了，大家可以按照这些概念实现一个demo去体验LiteFlow那解耦，以及流程编排那种特爽的柑橘。当然大家也可以参考这篇文章去实现demo：<a href="https://www.coderacademy.online/article/springbootliteflowuse.html">SpringBoot+LiteFlow优雅解耦复杂核心业务 | 码农Academy的博客 (coderacademy.online)</a></p>
<p>后面我们在介绍LiteFlow的一些高级特性，例如：组件降级，组件继承，组建回滚，热刷新，以及使用代码构建规则，使用脚本构建组件，还有使用Nacos，Redis作为规则文件源等。</p>

            </div>
            <hr />

            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>微信里点“发现”->“扫一扫”二维码便可查看分享。</p>"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            

    <div class="reprint" id="reprint-statement">
        <p class="reprint-tip">
            <i class="fa fa-exclamation-triangle"></i>&nbsp;&nbsp;
            <span>转载规则</span>
        </p>
        
            <div class="center-align">
                <a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.zh">
                    <img alt=""
                         style="border-width:0"
                         src="https://i.creativecommons.org/l/by/4.0/88x31.png"/>
                </a>
            </div>
            <br/>
            <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text"
                  property="dct:title" rel="dct:type">
                    《轻松应对复杂业务逻辑：LiteFlow-编排式规则引擎框架的优势》
                </span> 由
            <a xmlns:cc="http://creativecommons.org/ns#" href="/article/4749dca98aed.html" property="cc:attributionName"
               rel="cc:attributionURL">
                码农Academy
            </a> 采用
            <a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.zh">
                知识共享署名 4.0 国际许可协议
            </a>进行许可。
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>


        </div>
    </div>

    
    <link rel="stylesheet" href="/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '查教程获取',
        clientSecret: '查教程获取',
        repo: 'coderacademyonline.github.io',
        owner: 'coderacademyonline',
        admin: "coderacademyonline",
        id: 'article/4749dca98aed.html',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>
    

    

    

    

    
    <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments input[type=text],
    #vcomments input[type=email],
    #vcomments input[type=url],
    #vcomments textarea {
        box-sizing: border-box;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #42b983;
        font-weight: 500;
        text-decoration: underline;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div id="vcomments" class="card-content"></div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<!-- <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script> -->

<script>
    new Valine({
        el: '#vcomments',
        appId: '查教程获取',
        appKey: '查教程获取',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'false' === 'true',
        avatar: 'wavatar',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: '如果你没有GitHub账号，还可以在这里评论啦！'
    });
</script>

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/article/springbootloadconfigdata.html">
                    <div class="card-image">
                        
                        <img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/featureimages/41.jpg" class="responsive-img" alt="华为二面：SpringBoot读取配置文件的原理是什么？加载顺序是什么？">
                        
                        <span class="card-title">华为二面：SpringBoot读取配置文件的原理是什么？加载顺序是什么？</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            本文解析SpringBoot配置文件加载的源码，理解配置文件的加载顺序。
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2024-02-03
                        </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/SpringBoot/" class="post-category" target="_blank">
                                    SpringBoot
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/SpringBoot/" target="_blank">
                        <span class="chip bg-color">SpringBoot</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/article/javastreamapi.html">
                    <div class="card-image">
                        
                        <img src="https://coderacademy.oss-cn-zhangjiakou.aliyuncs.com/featureimages/39.jpg" class="responsive-img" alt="提高Java开发生产力，我选Stream API,真香啊">
                        
                        <span class="card-title">提高Java开发生产力，我选Stream API,真香啊</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            本文深入介绍了Java 8的Stream API，包括创建、中间操作、终端操作等，强调了并行流在大数据处理中的性能提升。提供清晰实用的示例，为读者理解流式计算提供有益指导。
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2024-01-31
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Java/" class="post-category" target="_blank">
                                    Java
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Java/" target="_blank">
                        <span class="chip bg-color">Java</span>
                    </a>
                    
                    <a href="/tags/Stream流/" target="_blank">
                        <span class="chip bg-color">Stream流</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 码农Academy的博客<br />'
            + '作者: 码农Academy<br />'
            + '链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () { bodyElement.removeChild(newdiv); }, 200);
    });
</script>

    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fa fa-list"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).slideUp(500);
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).slideDown(500);
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>
    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\(', '\)']]}
    });
</script>

<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>
<!-- 代码语言 -->
<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>
<!-- 代码块复制 -->
<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>
<script type="text/javascript" src="/libs/codeBlock/clipboard.min.js"></script>
<!-- 代码块收缩 -->
<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script> 
<!-- 代码块折行 -->
<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>


    <footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            &copy; 2020-2025 码农Academy. 版权所有

            
            &nbsp;<i class="fa fa-area-chart"></i>&nbsp;站点总字数:&nbsp;
            <span class="white-color">191.3k</span>
            

            <br>
            <span id="sitetime"></span>

            
            
            <br>
            
            <span id="busuanzi_container_site_pv" style='display:none'>
                <i class="fa fa-heart-o"></i>
                本站总访问量 <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
            <span id="busuanzi_container_site_uv" style='display:none'>
                人次,&nbsp;访客数 <span id="busuanzi_value_site_uv" class="white-color"></span> 人.
            </span>
            
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/coderacademyonline" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>





    <a href="https://zhihu.com/people/coderacademy" class="tooltipped" target="_blank" data-tooltip="访问我的知乎" data-position="top" data-delay="50">
        <i class="fa fa-inverse">知</i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fa fa-rss"></i>
    </a>
</div>
    </div>
</footer>

<div class="progress-bar"></div>

<!-- 不蒜子计数初始值纠正 -->
<script>
    $(document).ready(function () {

        var int = setInterval(fixCount, 50);
        var pvcountOffset = 80000;
        var uvcountOffset = 20000;

        function fixCount() {
            if (document.getElementById("busuanzi_container_site_pv").style.display != "none") {
                $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + pvcountOffset);
                clearInterval(int);
            }
            if ($("#busuanzi_container_site_pv").css("display") != "none") {
                $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + uvcountOffset); // 加上初始数据 
                clearInterval(int);
            }
        }
    });
</script>

<script language=javascript>
    function siteTime() {
        window.setTimeout("siteTime()", 1000);
        var seconds = 1000;
        var minutes = seconds * 60;
        var hours = minutes * 60;
        var days = hours * 24;
        var years = days * 365;
        var today = new Date();
        var todayYear = today.getFullYear();
        var todayMonth = today.getMonth() + 1;
        var todayDate = today.getDate();
        var todayHour = today.getHours();
        var todayMinute = today.getMinutes();
        var todaySecond = today.getSeconds();
        /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
        year - 作为date对象的年份，为4位年份值
        month - 0-11之间的整数，做为date对象的月份
        day - 1-31之间的整数，做为date对象的天数
        hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
        minutes - 0-59之间的整数，做为date对象的分钟数
        seconds - 0-59之间的整数，做为date对象的秒数
        microseconds - 0-999之间的整数，做为date对象的毫秒数 */
        var t1 = Date.UTC(2017, 09, 11, 00, 00, 00); //北京时间2018-2-13 00:00:00
        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
        var diff = t2 - t1;
        var diffYears = Math.floor(diff / years);
        var diffDays = Math.floor((diff / days) - diffYears * 365);
        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes);
        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes * minutes) / seconds);
        document.getElementById("sitetime").innerHTML = "本站已运行 " + diffYears + " 年 " + diffDays + " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
    }/*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
    siteTime();
</script>

    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <script type="text/javascript"> var OriginTitile = document.title, st; document.addEventListener("visibilitychange", function () { document.hidden ? (document.title = "Σ(っ °Д °;)っ喔哟，崩溃啦！", clearTimeout(st)) : (document.title = "φ(゜▽゜*)♪咦，又好了！", st = setTimeout(function () { document.title = OriginTitile }, 3e3)) })
    </script>

    <!-- Global site tag (gtag.js) - Google Analytics -->

<script async src="https://www.googletagmanager.com/gtag/js?id=查教程获取"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', '查教程获取');
</script>



    
    <script src="/libs/others/clicklove.js"></script>
    

    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    <!-- 雪花特效 -->
    

</body>

</html>